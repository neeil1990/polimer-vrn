"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function closeCustomSelects(){document.addEventListener("click",function(e){for(var t=e.target.parentNode;t&&t!==document.body&&!t.classList.contains("custom-select")&&!t.classList.contains("custom-value-select");)t=t.parentNode;t&&(!t.classList.contains("custom-select")&&document.querySelector(".custom-select")&&document.querySelector(".custom-select").classList.remove("active"),!t.classList.contains("custom-value-select")&&document.querySelector(".custom-value-select")&&Array.from(document.querySelectorAll(".custom-value-select")).forEach(function(e){e.classList.remove("active")}))})}function searchMetaProps(){var e=document.querySelectorAll(".metainform__search-input");Array.from(e).forEach(function(i){i.addEventListener("input",function(){for(var e=i.parentNode.parentNode.querySelectorAll(".with-prop"),t=0;t<e.length;t++)e[t].textContent.toLowerCase().includes(this.value.toLowerCase())?e[t].style.display="block":e[t].style.display="none"})})}!function(c){BX.TreeConditions||(BX.TreeCondCtrlAtom=function(e,t,i){if(this.boolResult=!1,!e||!t||!t.values)return this.boolResult;if(this.parentContainer=e,this.valuesContainer=t.values,!BX.type.isNotEmptyString(i)&&!BX.type.isPlainObject(i))return this.boolResult;if(BX.type.isNotEmptyString(i)&&(i={text:i,type:"string"}),BX.type.isPlainObject(i)){if(!BX.type.isNotEmptyString(i.type))return this.boolResult;if(this.arStartParams=i,this.id=null,this.name=null,this.type=i.type,this.showValue=!1,BX.type.isNotEmptyString(i.show_value)&&(this.showValue="Y"===i.show_value),"string"!==this.type&&"prefix"!==this.type){if(!i.id)return this.boolResult;this.id=i.id,this.name=i.name?i.name:i.id,this.defaultText=BX.type.isNotEmptyString(i.defaultText)?i.defaultText:"...",this.defaultValue=i.defaultValue&&0<i.defaultValue.length?i.defaultValue:"",this.valuesContainer[this.id]&&0!==this.valuesContainer[this.id].length||(this.valuesContainer[this.id]=this.defaultValue)}this.boolResult=!0,"string"!==this.type&&"prefix"!==this.type||this.Init()}return this.boolResult},BX.TreeCondCtrlAtom.prototype.Init=function(){return this.boolResult&&(this.parentContainer=BX(this.parentContainer),this.parentContainer?"string"===this.type||"prefix"===this.type?this.parentContainer.appendChild(BX.create("SPAN",{props:{className:"prefix"===this.type?"control-prefix":"control-string"},html:BX.util.htmlspecialchars(this.arStartParams.text)})):this.CreateLink():this.boolResult=!1),this.boolResult},BX.TreeCondCtrlAtom.prototype.IsValue=function(){return this.valuesContainer[this.id]&&0<this.valuesContainer[this.id].length},BX.TreeCondCtrlAtom.prototype.InitValue=function(){return this.IsValue()},BX.TreeCondCtrlAtom.prototype.ReInitValue=function(e){BX.util.in_array(this.id,e)&&this.InitValue()},BX.TreeCondCtrlAtom.prototype.SetValue=function(){return this.IsValue()},BX.TreeCondCtrlAtom.prototype.View=function(e){},BX.TreeCondCtrlAtom.prototype.onChange=function(){this.SetValue(),this.View(!1)},BX.TreeCondCtrlAtom.prototype.onKeypress=function(e){if((e=e||c.event).keyCode){switch(e.keyCode){case 13:this.onChange();break;case 27:this.InitValue(),this.View(!1)}if(13===e.keyCode)return BX.PreventDefault(e)}},BX.TreeCondCtrlAtom.prototype.onClick=function(){this.InitValue(),this.View(!0)},BX.TreeCondCtrlAtom.prototype.Delete=function(){"string"!==this.type&&this.link&&(BX.unbindAll(this.link),this.link=BX.remove(this.link))},BX.TreeCondCtrlAtom.prototype.CreateLink=function(){return this.boolResult&&(this.link=null,this.link=this.parentContainer.appendChild(BX.create("A",{props:{id:this.parentContainer.id+"_"+this.id+"_link",className:"tree-link"},style:{display:""},html:this.IsValue()?BX.util.htmlspecialchars(this.valuesContainer[this.id]):this.defaultText})),this.link||(this.boolResult=!1)),this.boolResult},BX.TreeCondCtrlAtom.prototype.prepareData=function(e,t){var i,s="",l="",n=!0;if(BX.type.isString(e))s=e;else if(BX.type.isPlainObject(e))for(i in e)e.hasOwnProperty(i)&&(s+=n?"":"&",l=BX.util.urlencode(i),t&&(l=t+"["+l+"]"),BX.type.isPlainObject(e[i])?s+=this.prepareData(e[i],l):s+=l+"="+BX.util.urlencode(e[i]),n=!1);return s},BX.TreeCondCtrlAtom.prototype.ViewFormat=function(e,t){return this.showValue?t+" ["+e+"]":t},BX.TreeCondCtrlInput=function(e,t,i){return BX.TreeCondCtrlInput.superclass.constructor.apply(this,arguments)&&this.Init(),this.boolResult},BX.extend(BX.TreeCondCtrlInput,BX.TreeCondCtrlAtom),BX.TreeCondCtrlInput.prototype.Init=function(){return this.boolResult&&BX.TreeCondCtrlInput.superclass.Init.apply(this,arguments)&&(this.input=null,this.input=this.parentContainer.appendChild(BX.create("INPUT",{props:{type:"text",id:this.parentContainer.id+"_"+this.id,name:this.name,className:"",value:this.IsValue()?this.valuesContainer[this.id]:""},style:{display:"none"},events:{change:BX.proxy(this.onChange,this),blur:BX.proxy(this.onChange,this),keypress:BX.proxy(this.onKeypress,this)}})),this.boolResult=!!this.input),this.boolResult},BX.TreeCondCtrlInput.prototype.InitValue=function(){BX.TreeCondCtrlInput.superclass.InitValue.apply(this,arguments)?(BX.adjust(this.link,{html:BX.util.htmlspecialchars(this.valuesContainer[this.id])}),this.input.value=this.valuesContainer[this.id]):(BX.adjust(this.link,{html:this.defaultText}),this.input.value="")},BX.TreeCondCtrlInput.prototype.SetValue=function(){this.valuesContainer[this.id]=this.input.value,BX.TreeCondCtrlInput.superclass.SetValue.apply(this,arguments)?BX.adjust(this.link,{html:BX.util.htmlspecialchars(this.valuesContainer[this.id])}):BX.adjust(this.link,{html:this.defaultText})},BX.TreeCondCtrlInput.prototype.View=function(e){BX.TreeCondCtrlInput.superclass.View.apply(this,arguments),e?(BX.style(this.link,"display","none"),BX.style(this.input,"display",""),BX.focus(this.input)):(BX.style(this.input,"display","none"),BX.style(this.link,"display",""),this.input.blur())},BX.TreeCondCtrlInput.prototype.Delete=function(){BX.TreeCondCtrlInput.superclass.Delete.apply(this,arguments),this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input))},BX.TreeCondCtrlInput.prototype.CreateLink=function(){return BX.TreeCondCtrlInput.superclass.CreateLink.apply(this,arguments)&&BX.bind(this.link,"click",BX.proxy(this.onClick,this)),this.boolResult},BX.TreeCondCtrlBaseSelect=function(e,t,i){return this.values=[],this.labels=[],this.multiple=!1,this.size=3,this.first_option="...",this.boolVisual=!1,this.visual=null,BX.TreeCondCtrlBaseSelect.superclass.constructor.apply(this,arguments)&&(BX.type.isNotEmptyString(i.multiple)&&(this.multiple="Y"===i.multiple),(BX.type.isString(i.size)||BX.type.isNumber(i.size))&&(i.size=parseInt(i.size,10),!isNaN(i.size)&&0<i.size&&(this.size=i.size)),BX.type.isNotEmptyString(i.first_option)&&(this.first_option=i.first_option),this.dontShowFirstOption=!!i.dontShowFirstOption),this.boolResult},BX.extend(BX.TreeCondCtrlBaseSelect,BX.TreeCondCtrlAtom),BX.TreeCondCtrlBaseSelect.prototype.Init=function(){return BX.TreeCondCtrlInput.superclass.Init.apply(this,arguments),this.boolResult},BX.TreeCondCtrlBaseSelect.prototype.setValueText=function(){var e,t,i=[];if(BX.type.isString(this.valuesContainer[this.id])&&(this.valuesContainer[this.id]=this.valuesContainer[this.id].split(",")),"value"===this.id&&"select"===this.type){var s=this.select.querySelectorAll(".custom-value-select__property");for(e=0;e<s.length;e++)if(BX.util.in_array(s[e].dataset.value,this.valuesContainer[this.id])&&-1<(t=BX.util.array_search(s[e].dataset.value,this.values))){var l=document.getElementById(this.parentContainer.id+"_"+this.id);document.getElementById(this.parentContainer.id+"_"+this.id+"_send").value=s[e].dataset.value,"-1"===l.dataset.index&&(l.dataset.index=e,l.value=s[e].textContent),i[i.length]=this.ViewFormat(this.values[t],this.labels[t])}}else for(this.select.selectedIndex=-1,e=0;e<this.select.options.length;e++)BX.util.in_array(this.select.options[e].value,this.valuesContainer[this.id])&&-1<(t=BX.util.array_search(this.select.options[e].value,this.values))?(this.select.options[e].selected=!0,-1===this.select.selectedIndex&&(this.select.selectedIndex=e),i[i.length]=this.ViewFormat(this.values[t],this.labels[t])):this.select.options[e].selected=!1;0===i.length&&(i[0]=this.defaultText),BX.adjust(this.link,{html:BX.util.htmlspecialchars(i.join(", "))}),i=null},BX.TreeCondCtrlBaseSelect.prototype.SetValue=function(){var e,t,i=[],s=[];if(this.multiple){for(e=0;e<this.select.options.length;e++)this.select.options[e].selected&&(s[s.length]=this.select.options[e].value,-1<(t=BX.util.array_search(this.select.options[e].value,this.values))&&(i[i.length]=this.ViewFormat(this.values[t],this.labels[t])));0===i.length&&(i[0]=this.defaultText),this.valuesContainer[this.id]=s}else if("value"===this.id&&"select"===this.type){var l=document.getElementById(this.parentContainer.id+"_"+this.id),n=this.select.querySelectorAll(".custom-value-select__property"),o=document.getElementById(this.parentContainer.id+"_"+this.id+"_send");-1<l.dataset.index&&n[l.dataset.index]&&(this.valuesContainer[this.id]=[o.value],e=BX.util.array_search(o.value,this.values),i[0]=-1<e?this.ViewFormat(this.values[e],this.labels[e]):this.defaultText)}else-1<this.select.selectedIndex&&this.select.options[this.select.selectedIndex]&&(this.valuesContainer[this.id]=[this.select.options[this.select.selectedIndex].value],e=BX.util.array_search(this.select.options[this.select.selectedIndex].value,this.values),i[0]=-1<e?this.ViewFormat(this.values[e],this.labels[e]):this.defaultText);BX.TreeCondCtrlBaseSelect.superclass.SetValue.apply(this,arguments)?BX.adjust(this.link,{html:BX.util.htmlspecialchars(i.join(", "))}):BX.adjust(this.link,{html:this.defaultText})},BX.TreeCondCtrlBaseSelect.prototype.View=function(e){BX.TreeCondCtrlBaseSelect.superclass.View.apply(this,arguments),e?(BX.style(this.link,"display","none"),BX.style(this.select,"display",""),BX.focus(this.select)):(BX.style(this.select,"display","none"),BX.style(this.link,"display",""),this.select.blur())},BX.TreeCondCtrlBaseSelect.prototype.onChange=function(){this.SetValue(),this.multiple||this.View(!1),this.boolVisual&&this.visual()},BX.TreeCondCtrlBaseSelect.prototype.onBlur=function(){this.View(!1)},BX.TreeCondCtrlBaseSelect.prototype.onKeypress=function(e){if((e=e||c.event).keyCode&&(13===e.keyCode||27===e.keyCode)&&(this.View(!1),13===e.keyCode))return BX.PreventDefault(e)},BX.TreeCondCtrlBaseSelect.prototype.onClick=function(){this.View(!0)},BX.TreeCondCtrlBaseSelect.prototype.Delete=function(){BX.TreeCondCtrlBaseSelect.superclass.Delete.apply(this,arguments),this.select&&(BX.unbindAll(this.select),this.select=BX.remove(this.select)),this.boolVisual&&(this.visual=null)},BX.TreeCondCtrlBaseSelect.prototype.CreateLink=function(){return BX.TreeCondCtrlBaseSelect.superclass.CreateLink.apply(this,arguments)&&BX.bind(this.link,"click",BX.proxy(this.onClick,this)),this.boolResult},BX.TreeCondCtrlBaseSelect.prototype.CreateSelect=function(){var e={id:this.parentContainer.id+"_"+this.id,name:this.name,selectedIndex:-1};this.multiple&&(e.name=this.name+"[]",e.multiple=!0,e.size=this.size),"value"===this.id&&"select"===this.type?(this.select=this.parentContainer.appendChild(BX.create("DIV",{props:{className:"custom-value-select"},style:{display:"none"}})),this.select.appendChild(BX.create("INPUT",{props:{id:this.parentContainer.id+"_"+this.id,type:"text",placeholder:this.first_option,className:"custom-value-select__result-input"},attrs:{readonly:"true"},dataset:{index:"-1"},events:{click:function(){this.parentNode.classList.toggle("active")}}})),this.select.appendChild(BX.create("INPUT",{props:{type:"hidden",name:this.name,id:this.parentContainer.id+"_"+this.id+"_send"}})),this.selectWrapper=this.select.appendChild(BX.create("DIV",{props:{className:"custom-value-select__props-wrapper"}})),this.selectWrapper.appendChild(BX.create("INPUT",{props:{type:"text",className:"custom-value-select__search-props"},events:{input:function(){for(var e=this.parentNode.querySelectorAll(".custom-value-select__property"),t=0;t<e.length;t++)e[t].textContent.toLowerCase().includes(this.value.toLowerCase())?e[t].style.display="block":e[t].style.display="none"}}})),this.selectPropsContainer=this.selectWrapper.appendChild(BX.create("DIV",{props:{className:"custom-value-select__props-container"}})),BX.type.isElementNode(this.select)&&(this.multiple||this.dontShowFirstOption||this.selectPropsContainer.appendChild(BX.create("div",{props:{className:"custom-value-select__property"},dataset:{value:"",index:0},events:{click:BX.delegate(function(){var e=document.getElementById(this.parentContainer.id+"_"+this.id);document.getElementById(this.parentContainer.id+"_"+this.id+"_send").value="",e.value=this.first_option,e.parentNode.classList.remove("active"),e.dataset.index="0",this.onChange()},this)},html:this.first_option})))):(this.select=this.parentContainer.appendChild(BX.create("SELECT",{props:e,style:{display:"none"},events:{change:BX.proxy(this.onChange,this),blur:BX.proxy(this.onBlur,this),keypress:BX.proxy(this.onKeypress,this)}})),BX.type.isElementNode(this.select)&&(this.multiple||this.dontShowFirstOption||this.select.appendChild(BX.create("option",{props:{value:""},html:this.first_option})))),e=null},BX.TreeCondCtrlSelect=function(e,t,i){var s;if(BX.TreeCondCtrlSelect.superclass.constructor.apply(this,arguments)){if(!BX.type.isPlainObject(i.values))return this.boolResult;for(s in i.values)i.values.hasOwnProperty(s)&&(this.values[this.values.length]=s,this.labels[this.labels.length]=i.values[s]);if(0===this.values.length)return this.boolResult;0<this.defaultValue.length&&(s=BX.util.array_search(this.defaultValue,this.values),this.defaultText=-1<s?this.labels[s]:""),BX.type.isPlainObject(i.events)&&BX.type.isFunction(i.events.visual)&&(this.boolVisual=!0,this.visual=i.events.visual),this.Init()}return this.boolResult},BX.extend(BX.TreeCondCtrlSelect,BX.TreeCondCtrlBaseSelect),BX.TreeCondCtrlSelect.prototype.Init=function(){var l,n=this;if(this.boolResult&&BX.TreeCondCtrlSelect.superclass.Init.apply(this,arguments)){if(this.CreateSelect(),BX.type.isElementNode(this.select)){var e=function(){var t=Number(l);if(n.values.hasOwnProperty(l))if("value"===n.id&&"select"===n.type){var i=n.values[l],s=BX.util.htmlspecialchars(n.ViewFormat(n.values[l],n.labels[l])),e=t+1;n.selectPropsContainer.appendChild(BX.create("div",{props:{className:"custom-value-select__property"},dataset:{value:i,index:e},events:{click:BX.delegate(function(){var e=document.getElementById(this.parentContainer.id+"_"+this.id);document.getElementById(this.parentContainer.id+"_"+this.id+"_send").value=i,e.value=s,e.parentNode.classList.remove("active"),e.dataset.index=t.toString(),this.onChange()},n)},html:BX.util.htmlspecialchars(n.ViewFormat(n.values[l],n.labels[l]))}))}else n.select.appendChild(BX.create("option",{props:{value:n.values[l]},html:BX.util.htmlspecialchars(n.ViewFormat(n.values[l],n.labels[l]))}))};for(l in this.values)e();this.InitValue()}this.boolResult=!!this.select}return this.boolResult},BX.TreeCondCtrlSelect.prototype.InitValue=function(){BX.TreeCondCtrlSelect.superclass.InitValue.apply(this,arguments)?this.setValueText():this.select.selectedIndex=-1},BX.TreeCondCtrlSelect.prototype.CreateLink=function(){return BX.TreeCondCtrlSelect.superclass.CreateLink.apply(this,arguments)&&BX.bind(this.link,"click",BX.proxy(this.onClick,this)),this.boolResult},BX.TreeCondCtrlLazySelect=function(e,t,i){var s;if(this.loaded=!1,this.loadProgress=!1,this.loadUrl="",this.loadUrlParams={},BX.TreeCondCtrlLazySelect.superclass.constructor.apply(this,arguments)){if(BX.type.isNotEmptyString(i.load_url)&&(this.loadUrl=i.load_url),BX.type.isPlainObject(i.load_params))for(s in i.load_params)i.load_params.hasOwnProperty(s)&&(this.loadUrlParams[s]=i.load_params[s]);this.Init()}return this.boolResult},BX.extend(BX.TreeCondCtrlLazySelect,BX.TreeCondCtrlBaseSelect),BX.TreeCondCtrlLazySelect.prototype.Init=function(){return this.boolResult&&BX.TreeCondCtrlLazySelect.superclass.Init.apply(this,arguments)&&(this.CreateSelect(),this.InitValue()),this.boolResult},BX.TreeCondCtrlLazySelect.prototype.InitValue=function(){BX.TreeCondCtrlLazySelect.superclass.InitValue.apply(this,arguments)?this.loaded?this.setValueText():this.ajaxLoad("InitValue"):this.select.selectedIndex=-1},BX.TreeCondCtrlLazySelect.prototype.ajaxLoad=function(e){var t,i,s={};if(!this.loaded&&!this.loadProgress){for(t in this.loadUrlParams)this.loadUrlParams.hasOwnProperty(t)&&(s[t]=this.loadUrlParams[t]);switch(s.sessid=BX.bitrix_sessid(),s.lang=BX.message("LANGUAGE_ID"),e){default:case"InitValue":i=BX.proxy(this.ajaxLoadResultFromInit,this);break;case"onClick":i=BX.proxy(this.ajaxLoadResultFromClick,this)}this.loadProgress=!0,BX.showWait(this.parentContainer),BX.ajax({method:"POST",dataType:"json",url:this.loadUrl,data:s,onsuccess:i}),s=i=null}},BX.TreeCondCtrlLazySelect.prototype.ajaxLoadResult=function(e){var t;if(this.loadProgress=!1,BX.closeWait(this.parentContainer),BX.type.isArray(e)){for(t=0;t<e.length;t++)this.values[this.values.length]=e[t].value,this.labels[this.labels.length]=e[t].label,this.select.appendChild(BX.create("option",{props:{value:e[t].value},html:BX.util.htmlspecialchars(this.ViewFormat(e[t].value,e[t].label))}));this.loaded=!0}},BX.TreeCondCtrlLazySelect.prototype.ajaxLoadResultFromInit=function(e){BX.type.isArray(e)&&(this.ajaxLoadResult(e),this.loaded&&this.setValueText())},BX.TreeCondCtrlLazySelect.prototype.ajaxLoadResultFromClick=function(e){BX.type.isArray(e)&&(this.ajaxLoadResult(e),this.loaded&&this.onClick())},BX.TreeCondCtrlLazySelect.prototype.onClick=function(){this.loaded?this.View(!0):this.ajaxLoad("onClick")},BX.TreeCondCtrlPopup=function(e,t,i){var s;if(BX.TreeCondCtrlPopup.superclass.constructor.apply(this,arguments)){if(!i.popup_url)return this.boolResult;if(this.popup_url=i.popup_url,this.popup_params={},i.popup_params)for(s in i.popup_params)i.popup_params.hasOwnProperty(s)&&(this.popup_params[s]=i.popup_params[s]);this.popup_param_id=null,BX.type.isNotEmptyString(i.param_id)&&(this.popup_param_id=i.param_id),this.label="",t.labels&&t.labels[this.id]&&(this.label=t.labels[this.id]),0===this.label.length&&(this.label=0<this.valuesContainer[this.id].length?this.valuesContainer[this.id]:this.defaultText),this.Init()}return this.boolResult},BX.extend(BX.TreeCondCtrlPopup,BX.TreeCondCtrlAtom),BX.TreeCondCtrlPopup.prototype.Init=function(){return this.boolResult&&BX.TreeCondCtrlPopup.superclass.Init.apply(this,arguments)&&(this.popup_param_id&&(this.popup_params[this.popup_param_id]=this.parentContainer.id+"_"+this.id),this.input=this.parentContainer.appendChild(BX.create("INPUT",{props:{type:"hidden",id:this.parentContainer.id+"_"+this.id,name:this.name,className:"",value:this.IsValue()?this.valuesContainer[this.id]:""},style:{display:"none"},events:{change:BX.proxy(this.onChange,this)}})),this.boolResult=!!this.input),this.boolResult},BX.TreeCondCtrlPopup.prototype.CreateLink=function(){return this.boolResult&&(this.link=this.parentContainer.appendChild(BX.create("A",{props:{id:this.parentContainer.id+"_"+this.id+"_link",className:""},style:{display:""},html:this.IsValue()?BX.util.htmlspecialchars(this.ViewFormat(this.valuesContainer[this.id],this.label)):this.defaultText,events:{click:BX.proxy(this.PopupShow,this)}})),this.boolResult=!!this.link),this.boolResult},BX.TreeCondCtrlPopup.prototype.PopupShow=function(){var e=this.popup_url,t=this.prepareData(this.popup_params);0<t.length&&(e+=(-1!==e.indexOf("?")?"&":"?")+t),c.open(e,"","scrollbars=yes,resizable=yes,width=900,height=600,top="+parseInt((screen.height-500)/2-14,10)+",left="+parseInt((screen.width-600)/2-5,10)).onbeforeunload=function(){BX.onCustomEvent("onTreeCondPopupClose")}},BX.TreeCondCtrlPopup.prototype.onChange=function(){this.valuesContainer[this.id]=this.input.value},BX.TreeCondCtrlPopup.prototype.Delete=function(){BX.TreeCondCtrlPopup.superclass.Delete.apply(this,arguments),this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input))},BX.TreeUserCondCtrlPopup=function(e,t,i){var s;if(BX.TreeUserCondCtrlPopup.superclass.constructor.apply(this,arguments)){if(!i.popup_url)return this.boolResult;if(this.user_load_url=i.user_load_url,this.popup_url=i.popup_url,i.popup_params)for(s in i.popup_params)i.popup_params.hasOwnProperty(s)&&(this.popup_params[s]=i.popup_params[s]);this.popup_param_id=null,BX.type.isNotEmptyString(i.param_id)&&(this.popup_param_id=i.param_id),this.label="",t.labels&&t.labels[this.id]&&(this.label=t.labels[this.id]),0===this.label.length&&(this.label=0<this.valuesContainer[this.id].length?this.valuesContainer[this.id]:this.defaultText)}return this.boolResult},BX.extend(BX.TreeUserCondCtrlPopup,BX.TreeCondCtrlPopup),BX.TreeUserCondCtrlPopup.prototype.Init=function(){var e;if(this.inputs=[],""===this.valuesContainer[this.id]&&(this.valuesContainer[this.id]=[],this.label=[]),BX.type.isArray(this.valuesContainer[this.id])||(this.valuesContainer[this.id]=[this.valuesContainer[this.id]],this.label=[this.label]),this.boolResult&&BX.TreeUserCondCtrlPopup.superclass.Init.apply(this,arguments)){if(this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input)),this.popup_param_id&&(this.popup_params[this.popup_param_id]=this.parentContainer.id+"_"+this.id),this.IsValue())for(e in this.valuesContainer[this.id])this.valuesContainer[this.id].hasOwnProperty(e)&&this.AppendInputNode(this.parentContainer.id+"_"+this.id,this.name+"[]",this.valuesContainer[this.id][e]);else this.AppendInputNode(this.parentContainer.id+"_"+this.id,this.name+"[]","");this.AppendFakeInputNode(this.parentContainer.id+"_"+this.id,this.name),this.boolResult=!!this.inputs}return this.boolResult},BX.TreeUserCondCtrlPopup.prototype.CreateLink=function(){var e;if(this.popup_params.FN="sale_discount_form",this.popup_params.FC="fake_"+this.name,this.boolResult){for(e in this.defaultLabel=BX.create("SPAN",{text:this.defaultText,style:{cursor:"pointer"},props:{className:"condition-dots"}}),this.link=this.parentContainer.appendChild(BX.create("SPAN",{props:{id:this.parentContainer.id+"_"+this.id+"_link",className:"condition-list-wrap"},style:{display:""},events:{click:BX.proxy(this.PopupShow,this)},children:[this.defaultLabel]})),this.valuesContainer[this.id])this.valuesContainer[this.id].hasOwnProperty(e)&&this.AppendItemNode(this.valuesContainer[this.id][e],this.label[e]);this.boolResult=!!this.link}return this.boolResult},BX.TreeUserCondCtrlPopup.prototype.AppendItemNode=function(e,t){this.link.insertBefore(BX.create("SPAN",{props:{className:"condition-item"},style:{display:""},children:[BX.create("SPAN",{props:{className:"condition-item-text"},html:BX.util.htmlspecialchars(this.ViewFormat(e,t))}),BX.create("SPAN",{props:{className:"condition-item-del"},attrs:{"bx-data-value":e},events:{click:BX.proxy(this.DeleteItem,this)}})]}),this.defaultLabel)},BX.TreeUserCondCtrlPopup.prototype.AppendInputNode=function(e,t,i){this.inputs.push(this.parentContainer.appendChild(BX.create("INPUT",{props:{type:"hidden",id:e,name:t,value:i},style:{display:"none"},events:{change:BX.proxy(this.onChange,this)}})))},BX.TreeUserCondCtrlPopup.prototype.AppendFakeInputNode=function(e,t){this.inputs.push(this.parentContainer.appendChild(BX.create("INPUT",{props:{type:"hidden",id:"fake_"+e,name:"fake_"+t},style:{display:"none"},events:{change:BX.proxy(this.onChangeFake,this)}})))},BX.TreeUserCondCtrlPopup.prototype.onChangeFake=function(e){var i=e.target.value;BX.ajax({method:"POST",dataType:"json",url:this.user_load_url,data:{sessid:BX.bitrix_sessid(),AJAX_ACTION:"getUserName",USER_ID:i},onsuccess:BX.delegate(function(e){var t=e.name;this.AppendInputNode(this.parentContainer.id+"_"+this.id,this.name+"[]",i),this.AppendItemNode(i,t),this.valuesContainer[this.id].push(i)},this)})},BX.TreeUserCondCtrlPopup.prototype.onSave=function(e){BX.type.isPlainObject(e)&&(this.AppendInputNode(this.parentContainer.id+"_"+this.id,this.name+"[]",e.id),this.AppendItemNode(e.id,e.name),this.valuesContainer[this.id].push(e.id))},BX.TreeUserCondCtrlPopup.prototype.DeleteItem=function(e){var t=e.target||e.srcElement;t?(BX.findParent(t,{className:"condition-item",tagName:"span"},3)&&(BX.remove(BX.findParent(t,{className:"condition-item",tagName:"span"},3)),BX.remove(BX.findChild(this.parentContainer,{tagName:"input",attribute:{name:this.name+"[]",value:t.getAttribute("bx-data-value")}},3))),BX.PreventDefault(e)):BX.PreventDefault(e)},BX.TreeUserCondCtrlPopup.prototype.Delete=function(){if(BX.TreeUserCondCtrlPopup.superclass.Delete.apply(this,arguments),this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input)),this.inputs){for(var e in this.inputs)this.inputs.hasOwnProperty(e)&&(BX.unbindAll(this.inputs[e]),BX.remove(this.inputs[e]),delete this.inputs[e]);this.inputs=[]}this.dialog&&(this.dialog=null)},BX.TreeCondCtrlDialog=function(e,t,i){var s;return BX.TreeCondCtrlDialog.superclass.constructor.apply(this,arguments)&&(this.popup_params.event="onTreeCondDialogSave",0<(s=this.prepareData(this.popup_params)).length&&(this.popup_url+=(-1!==this.popup_url.indexOf("?")?"&":"?")+s),this.dialog=null),this.boolResult},BX.extend(BX.TreeCondCtrlDialog,BX.TreeCondCtrlPopup),BX.TreeCondCtrlDialog.prototype.CreateLink=function(){return this.boolResult&&(this.link=this.parentContainer.appendChild(BX.create("A",{props:{id:this.parentContainer.id+"_"+this.id+"_link",className:""},style:{display:""},html:this.IsValue()?BX.util.htmlspecialchars(this.ViewFormat(this.valuesContainer[this.id],this.label)):this.defaultText,events:{click:BX.proxy(this.DialogShow,this)}})),this.boolResult=!!this.link),this.boolResult},BX.TreeCondCtrlDialog.prototype.onChange=function(){this.valuesContainer[this.id]=this.input.value},BX.TreeCondCtrlDialog.prototype.DialogShow=function(){null!==this.dialog&&(this.dialog=null),this.dialog=new BX.CAdminDialog({content_url:this.popup_url,height:Math.max(500,c.innerHeight-400),width:Math.max(800,c.innerWidth-400),draggable:!0,resizable:!0,min_height:500,min_width:800}),this.dialog&&(BX.addCustomEvent("onTreeCondDialogSave",BX.proxy(this.onSave,this)),this.dialog.Show())},BX.TreeCondCtrlDialog.prototype.onSave=function(e){BX.removeCustomEvent("onTreeCondDialogSave",BX.proxy(this.onSave,this)),BX.type.isPlainObject(e)&&(this.input.value=e.id,this.link.innerHTML=BX.util.htmlspecialchars(this.ViewFormat(e.id,e.name)),this.onChange()),this.dialog.Close(),this.dialog=null},BX.TreeCondCtrlDialog.prototype.Delete=function(){BX.TreeCondCtrlDialog.superclass.Delete.apply(this,arguments),this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input)),this.dialog&&(this.dialog=null)},BX.TreeMultiCondCtrlDialog=function(e,t,i){var s;return this.defaultLabel=null,BX.TreeMultiCondCtrlDialog.superclass.constructor.apply(this,arguments)&&(this.popup_params.event="onTreeCondDialogSave",0<(s=this.prepareData(this.popup_params)).length&&(this.popup_url+=(-1!==this.popup_url.indexOf("?")?"&":"?")+s),this.dialog=null,BX.addClass(e,"condition-multi")),this.boolResult},BX.extend(BX.TreeMultiCondCtrlDialog,BX.TreeCondCtrlPopup),BX.TreeMultiCondCtrlDialog.prototype.AppendItemNode=function(e,t){this.link.insertBefore(BX.create("SPAN",{props:{className:"condition-item"},style:{display:""},children:[BX.create("SPAN",{props:{className:"condition-item-text"},html:BX.util.htmlspecialchars(this.ViewFormat(e,t))}),BX.create("SPAN",{props:{className:"condition-item-del"},attrs:{"bx-data-value":e},events:{click:BX.proxy(this.DeleteItem,this)}})]}),this.defaultLabel)},BX.TreeMultiCondCtrlDialog.prototype.AppendInputNode=function(e,t,i){this.inputs.push(this.parentContainer.appendChild(BX.create("INPUT",{props:{type:"hidden",id:e,name:t,value:i},style:{display:"none"},events:{change:BX.proxy(this.onChange,this)}})))},BX.TreeMultiCondCtrlDialog.prototype.Init=function(){var e;if(this.inputs=[],""===this.valuesContainer[this.id]&&(this.valuesContainer[this.id]=[],this.label=[]),BX.type.isArray(this.valuesContainer[this.id])||(this.valuesContainer[this.id]=[this.valuesContainer[this.id]],this.label=[this.label]),this.boolResult&&BX.TreeMultiCondCtrlDialog.superclass.Init.apply(this,arguments)){if(this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input)),this.popup_param_id&&(this.popup_params[this.popup_param_id]=this.parentContainer.id+"_"+this.id),this.IsValue())for(e in this.valuesContainer[this.id])this.valuesContainer[this.id].hasOwnProperty(e)&&this.AppendInputNode(this.parentContainer.id+"_"+this.id,this.name+"[]",this.valuesContainer[this.id][e]);else this.AppendInputNode(this.parentContainer.id+"_"+this.id,this.name+"[]","");this.boolResult=!!this.inputs}return this.boolResult},BX.TreeMultiCondCtrlDialog.prototype.CreateLink=function(){var e;if(this.boolResult){for(e in this.defaultLabel=BX.create("SPAN",{text:this.defaultText,style:{cursor:"pointer"},props:{className:"condition-dots"}}),this.link=this.parentContainer.appendChild(BX.create("SPAN",{props:{id:this.parentContainer.id+"_"+this.id+"_link",className:"condition-list-wrap"},style:{display:""},events:{click:BX.proxy(this.DialogShow,this)},children:[this.defaultLabel]})),this.valuesContainer[this.id])this.valuesContainer[this.id].hasOwnProperty(e)&&this.AppendItemNode(this.valuesContainer[this.id][e],this.label[e]);this.boolResult=!!this.link}return this.boolResult},BX.TreeMultiCondCtrlDialog.prototype.onChange=function(){},BX.TreeMultiCondCtrlDialog.prototype.DialogShow=function(){null!==this.dialog&&(this.dialog=null),this.dialog=new BX.CAdminDialog({content_url:this.popup_url,height:Math.max(500,c.innerHeight-400),width:Math.max(800,c.innerWidth-400),draggable:!0,resizable:!0,min_height:500,min_width:800}),this.dialog&&(BX.addCustomEvent("onTreeCondDialogSave",BX.proxy(this.onSave,this)),BX.addCustomEvent(this.dialog,"onWindowClose",BX.delegate(function(){BX.removeCustomEvent("onTreeCondDialogSave",BX.proxy(this.onSave,this))},this)),this.dialog.Show())},BX.TreeMultiCondCtrlDialog.prototype.onSave=function(e){BX.type.isPlainObject(e)&&(this.AppendInputNode(this.parentContainer.id+"_"+this.id,this.name+"[]",e.id),this.AppendItemNode(e.id,e.name),this.valuesContainer[this.id].push(e.id))},BX.TreeMultiCondCtrlDialog.prototype.DeleteItem=function(e){var t=e.target||e.srcElement;t?(BX.findParent(t,{className:"condition-item",tagName:"span"},3)&&(BX.remove(BX.findParent(t,{className:"condition-item",tagName:"span"},3)),BX.remove(BX.findChild(this.parentContainer,{tagName:"input",attribute:{name:this.name+"[]",value:t.getAttribute("bx-data-value")}},3))),BX.PreventDefault(e)):BX.PreventDefault(e)},BX.TreeMultiCondCtrlDialog.prototype.Delete=function(){if(BX.TreeMultiCondCtrlDialog.superclass.Delete.apply(this,arguments),this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input)),this.inputs){for(var e in this.inputs)this.inputs.hasOwnProperty(e)&&(BX.unbindAll(this.inputs[e]),BX.remove(this.inputs[e]),delete this.inputs[e]);this.inputs=[]}this.dialog&&(this.dialog=null)},BX.TreeCondCtrlDateTime=function(e,t,i){return BX.TreeCondCtrlDateTime.superclass.constructor.apply(this,arguments)&&(this.format=i.format&&"date"===i.format?"date":"datetime",this.Init()),this.boolResult},BX.extend(BX.TreeCondCtrlDateTime,BX.TreeCondCtrlAtom),BX.TreeCondCtrlDateTime.prototype.Init=function(){this.boolResult&&BX.TreeCondCtrlDateTime.superclass.Init.apply(this,arguments)&&(this.input=BX.create("INPUT",{props:{type:"text",id:this.parentContainer.id+"_"+this.id,name:this.name,className:"adm-input",value:this.IsValue()?this.valuesContainer[this.id]:""},events:{change:BX.proxy(this.onChange,this),keypress:BX.proxy(this.onKeypress,this)}}),this.icon=BX.create("SPAN",{props:{id:this.parentContainer.id+"_"+this.id+"_icon",className:"adm-calendar-icon",title:BX.message("JC_CORE_TREE_CONTROL_DATETIME_ICON")},events:{click:BX.proxy(this.ShowCalendarControl,this)}}),this.calendarText=BX.create("DIV",{props:{className:"adm-input-wrap"},children:[this.input,this.icon]}),this.calendar=this.parentContainer.appendChild(BX.create("DIV",{props:{id:this.parentContainer.id+"_"+this.id+"_calendar",className:"adm-calendar-block adm-filter-alignment"},style:{display:"none",verticalAlign:"middle"},children:[BX.create("DIV",{props:{className:"adm-filter-box-sizing"},style:{verticalAlign:"middle"},children:[this.calendarText]})]})),this.boolResult=!!this.calendar)},BX.TreeCondCtrlDateTime.prototype.InitValue=function(){BX.TreeCondCtrlDateTime.superclass.InitValue.apply(this,arguments)?(BX.adjust(this.link,{html:BX.util.htmlspecialchars(this.valuesContainer[this.id])}),this.input.value=this.valuesContainer[this.id]):(BX.adjust(this.link,{html:this.defaultText}),this.input.value="")},BX.TreeCondCtrlDateTime.prototype.SetValue=function(){this.valuesContainer[this.id]=this.input.value,BX.TreeCondCtrlDateTime.superclass.SetValue.apply(this,arguments)?BX.adjust(this.link,{html:BX.util.htmlspecialchars(this.valuesContainer[this.id])}):BX.adjust(this.link,{html:this.defaultText})},BX.TreeCondCtrlDateTime.prototype.View=function(e){BX.TreeCondCtrlDateTime.superclass.View.apply(this,arguments),e?(BX.style(this.link,"display","none"),BX.style(this.calendar,"display","inline-block"),BX.focus(this.input)):(BX.style(this.calendar,"display","none"),BX.style(this.link,"display",""))},BX.TreeCondCtrlDateTime.prototype.Delete=function(){BX.TreeCondCtrlDateTime.superclass.Delete.apply(this,arguments),this.input&&(BX.unbindAll(this.input),this.input=BX.remove(this.input)),this.icon&&(BX.unbindAll(this.icon),this.icon=BX.remove(this.icon)),this.calendarText&&(this.calendarText=BX.remove(this.calendarText)),this.calendar&&(BX.unbindAll(this.calendar),this.calendar=BX.remove(this.calendar))},BX.TreeCondCtrlDateTime.prototype.CreateLink=function(){return BX.TreeCondCtrlDateTime.superclass.CreateLink.apply(this,arguments)&&BX.bind(this.link,"click",BX.proxy(this.onClick,this)),this.boolResult},BX.TreeCondCtrlDateTime.prototype.ShowCalendarControl=function(){this.calendarText&&BX.calendar({node:this.calendarText,field:this.input,form:"",bTime:"datetime"===this.format,bHideTime:!1})},BX.TreeConditions=function(e,t,i){var s;if(BX.onCustomEvent("onTreeConditionsInit",[e,t,i]),this.boolResult=!1,!e||"object"!==_typeof(e)||!e.parentContainer)return this.boolResult;if(this.parentContainer=e.parentContainer,!e.form&&!e.formName)return this.boolResult;if(this.arStartParams=e,this.form=e.form?e.form:null,this.formName=e.formName?e.formName:null,this.mess=null,BX.type.isPlainObject(e.mess)&&(this.mess=e.mess,BX.message(this.mess)),this.messTree={SELECT_CONTROL:BX.message("JC_CORE_TREE_SELECT_CONTROL"),ADD_CONTROL:BX.message("JC_CORE_TREE_ADD_CONTROL"),DELETE_CONTROL:BX.message("JC_CORE_TREE_DELETE_CONTROL"),CONTROL_DATETIME_ICON:BX.message("JC_CORE_TREE_CONTROL_DATETIME_ICON"),CONDITION_ERROR:BX.message("JC_CORE_TREE_CONDITION_ERROR"),CONDITION_FATAL_ERROR:BX.message("JC_CORE_TREE_CONDITION_FATAL_ERROR")},BX.type.isPlainObject(e.messTree))for(s in e.messTree)e.messTree.hasOwnProperty(s)&&(this.messTree[s]=e.messTree[s]);if(this.sepID=e.sepID?e.sepID:"__",this.sepName=e.sepName?e.sepName:this.sepID,this.prefix=e.prefix?e.prefix:"rule",this.AtomTypes={prefix:BX.TreeCondCtrlAtom,input:BX.TreeCondCtrlInput,select:BX.TreeCondCtrlSelect,lazySelect:BX.TreeCondCtrlLazySelect,popup:BX.TreeCondCtrlPopup,userPopup:BX.TreeUserCondCtrlPopup,datetime:BX.TreeCondCtrlDateTime,dialog:BX.TreeCondCtrlDialog,multiDialog:BX.TreeMultiCondCtrlDialog},e.atomtypes&&"object"===_typeof(e.atomtypes))for(s in e.atomtypes)e.atomtypes.hasOwnProperty(s)&&!this.AtomTypes[s]&&(this.AtomTypes[s]=e.atomtypes[s]);return t&&"object"===_typeof(t)?(this.tree=t,i&&BX.type.isArray(i)&&(this.controls=i,this.boolResult=!0,BX.ready(BX.delegate(this.RenderTree,this))),this.boolResult):this.boolResult},BX.TreeConditions.prototype.Delete=function(){this.tree&&this.DeleteLevel(this.tree)},BX.TreeConditions.prototype.ControlSearch=function(e){var t,i=!1;if(this.boolResult&&this.controls)for(t=0;t<this.controls.length;t++)if(this.controls[t].controlgroup){if(!1!==(i=this.ControlInGrpSearch(this.controls[t].children,e)))break}else if(e===this.controls[t].controlId){i=this.controls[t];break}return i},BX.TreeConditions.prototype.ControlInGrpSearch=function(e,t){var i,s=!1;if(this.boolResult&&e)for(i=0;i<e.length;i++)if(t===e[i].controlId){s=e[i];break}return s},BX.TreeConditions.prototype.RenderTree=function(){return this.boolResult&&(this.form=this.form?BX(this.form):document.forms[this.formName],this.form?(this.formName=this.form.name,this.parentContainer=BX(this.parentContainer),this.parentContainer?(BX.adjust(this.parentContainer,{style:{position:"relative",zIndex:1}}),this.RenderLevel(this.parentContainer,null,this.tree)):this.boolResult=!1):this.boolResult=!1),this.boolResult},BX.TreeConditions.prototype.RenderLevel=function(e,t,i,s){var l,n,o,r,a,p,h,u,d,c,C,B=null,m=null;if(this.boolResult){if(!e)return this.boolResult=!1,this.boolResult;if("object"!==_typeof(i))return this.boolResult=!1,this.boolResult;if(null===i.id||void 0===i.id)return this.boolResult=!1,this.boolResult;if(null===i.controlId||void 0===i.controlId)return this.boolResult=!1,this.boolResult;if(!(l=this.ControlSearch(i.controlId)))return this.boolResult=!1,this.boolResult;if(n=l.group?null!==t?"condition-container":"condition-border":"condition-simple-control",o=parseInt(BX.style(e,"z-index"),10),isNaN(o)&&(o=1),!(m=(B=BX.create("DIV",{props:{id:e.id+this.sepID+i.id+"_wrap",className:"condition-wrapper"}})).appendChild(BX.create("DIV",{props:{id:e.id+this.sepID+i.id,className:n}}))))return this.boolResult=!1,this.boolResult;if(0===e.childNodes.length?e.appendChild(B):e.insertBefore(B,e.childNodes[e.childNodes.length-1]),m.appendChild(BX.create("INPUT",{props:{type:"hidden",id:m.id+"_controlId",name:(this.prefix+"["+e.id+this.sepID+i.id+"][controlId]").replace(this.parentContainer.id+this.sepID,""),className:"",value:i.controlId}})),i.wrapper=B,i.logic=null,i.container=m,i.obj=[],i.addBtn=null,i.deleteBtn=null,(i.visual=null)!==t&&(null!==i.showDeleteButton&&void 0!==i.showDeleteButton&&!0!==i.showDeleteButton||this.RenderDeleteBtn(i,t,l)),i.err_cond&&"Y"===i.err_cond&&m.appendChild(BX.create("SPAN",{props:{className:"condition-alert",title:i.err_cond_mess?i.err_cond_mess:i.fatal_err_cond?this.messTree.CONDITION_FATAL_ERROR:this.messTree.CONDITION_ERROR}})),!i.fatal_err_cond){for(l.group&&l.visual&&"object"===_typeof(l.visual)&&(i.visual=l.visual,i.visual.values&&BX.type.isArray(i.visual.values)&&i.visual.logic&&BX.type.isArray(i.visual.logic)&&i.visual.values.length===i.visual.logic.length||(i.visual=null)),r=0;r<l.control.length;r++)if(h=null,0<r&&m.appendChild(BX.create("SPAN",{props:{className:"condition-space"},html:"&nbsp;"})),"object"===_typeof(u=l.control[r])){for(p in d={},u)u.hasOwnProperty(p)&&(d[p]="name"===p?(this.prefix+"["+e.id+this.sepID+i.id+"]["+u[p]+"]").replace(this.parentContainer.id+this.sepID,""):u[p]);i.visual&&BX.util.in_array(u.id,i.visual.controls)&&(d.events||(d.events={}),d.events.visual=BX.delegate(function(){this.ChangeVisual(i)},this)),this.AtomTypes[u.type]&&("prefix"===u.type?h=new this.AtomTypes[u.type](m,i,d):(h=new this.AtomTypes[u.type](m,i,d),i.obj[i.obj.length]=h))}else h=new BX.TreeCondCtrlAtom(m,i,u);if(l.group&&(m.appendChild(BX.create("DIV",{props:{className:"condition-group-sep"}})),l.containsOneAction?this.RenderCreateOneActionBtn(i,l):this.RenderCreateBtn(i,l),i.children&&i.children.length&&0<i.children.length))if(i.visual&&"object"===_typeof(i.visual))if(-1<(c=this.SearchVisual(i)))for((C=i.visual.logic[c]).visual=BX.delegate(function(){this.NextVisual(i)},this),a=0;a<i.children.length;a++)this.RenderLevel(m,i,i.children[a]),a<i.children.length-1&&this.CreateLogic(i.children[a],i,C);else for(a=0;a<i.children.length;a++)this.RenderLevel(m,i,i.children[a]);else for(a=0;a<i.children.length;a++)this.RenderLevel(m,i,i.children[a])}}return this.boolResult},BX.TreeConditions.prototype.CreateLevel=function(e,t,i){var s,l,n;e&&e.children&&(null==i&&(i=e.children.length),e.children[e.children.length]={id:i,controlId:t,values:{},children:[]},this.RenderLevel(e.container,e,e.children[e.children.length-1])?(-1<(s=this.SearchForCreateLogic(e))&&-1<(l=this.SearchVisual(e))&&((n=e.visual.logic[l]).visual=BX.delegate(function(){this.NextVisual(e)},this),this.CreateLogic(e.children[s],e,n)),BX.onCustomEvent("onAdminTabsChange")):e.children.pop())},BX.TreeConditions.prototype.SearchForDeleteLevel=function(e,t){var i,s,l={indexDel:-1,indexPrev:-1};if(t&&t.children){for(i=0;i<t.children.length;i++)if(t.children[i]&&t.children[i]===e){l.indexDel=i;break}if(-1<l.indexDel&&t.visual&&"object"===_typeof(t.visual)){for(s=!0,i=l.indexDel+1;i<t.children.length;i++)if(t.children[i]){s=!1;break}if(s)for(i=l.indexDel-1;-1<i;i--)if(t.children[i]){l.indexPrev=i;break}}}return l},BX.TreeConditions.prototype.SearchForCreateLogic=function(e,t){var i,s=-1;if(e&&e.children&&e.visual&&"object"===_typeof(e.visual))for(null==t&&(t=e.children.length-1),i=t-1;-1<i;i--)if(e.children[i]){s=i;break}return s},BX.TreeConditions.prototype.DeleteLevel=function(e,t){var i,s;if(e){if(e.children){if(0<e.children.length)for(i=0;i<e.children.length;i++)this.DeleteLevel(e.children[i]);e.children.length=0}if(e.addBtn&&(e.addBtn.link&&(BX.unbindAll(e.addBtn.link),e.addBtn.link=BX.remove(e.addBtn.link)),e.addBtn.select&&(BX.unbindAll(e.addBtn.select),e.addBtn.link=BX.remove(e.addBtn.select)),e.addBtn=BX.remove(e.addBtn)),e.obj&&0<e.obj.length){for(i=0;i<e.obj.length;i++)e.obj[i].Delete();e.obj.length=0}e.deleteBtn&&(BX.unbindAll(e.deleteBtn),e.deleteBtn=BX.remove(e.deleteBtn)),BX.unbindAll(e.container),e.container=BX.remove(e.container),e.logic&&(BX.unbindAll(e.logic),e.logic=BX.remove(e.logic)),BX.unbindAll(e.wrapper),e.wrapper=BX.remove(e.wrapper),-1<(s=this.SearchForDeleteLevel(e,t)).indexDel&&(e=t.children[s.indexDel]=null),-1<s.indexPrev&&this.DeleteLogic(t.children[s.indexPrev]),BX.onCustomEvent("onAdminTabsChange"),BX.onCustomEvent("onAdminTabsDeleteLevel",[e,t])}},BX.TreeConditions.prototype.RenderCreateBtn=function(n,t){var o,r,a,p,h,u,d=this;if(this.boolResult)if(n.container){if(t.group){var e=function(){if(!(o=n.container.appendChild(BX.create("DIV",{props:{id:n.container.id+"_add",className:"condition-add"}}))))return d.boolResult=!1,{v:d.boolResult};n.addBtn=o,r=o.appendChild(BX.create("A",{props:{id:o.id+"_link"},style:{display:""},html:t.mess&&t.mess.ADD_CONTROL?t.mess.ADD_CONTROL:d.messTree.ADD_CONTROL}));var i=o.appendChild(BX.create("DIV",{props:{className:"custom-select"},style:{display:"none"},dataset:{id:o.id+"_select"}}));i.appendChild(BX.create("INPUT",{props:{className:"custom-select__input",type:"text",placeholder:t.mess&&t.mess.SELECT_CONTROL?t.mess.SELECT_CONTROL:d.messTree.SELECT_CONTROL},attrs:{readonly:"true"},events:{click:function(){this.parentNode.classList.toggle("active")}}}));var e=i.appendChild(BX.create("DIV",{props:{className:"custom-select__props-wrapper"}})),s=(e.appendChild(BX.create("input",{props:{className:"custom-select__search-props",type:"text"},events:{input:function(){for(var e=this.parentNode.querySelectorAll(".custom-select__item"),t=this.parentNode.querySelectorAll(".custom-select__group"),i=0;i<e.length;i++)e[i].textContent.toLowerCase().includes(this.value.toLowerCase())?e[i].style.display="block":e[i].style.display="none";Array.from(t).forEach(function(e){var t=e.querySelectorAll(".custom-select__item");e.style.display=function(e){var t=!0;return Array.from(e).forEach(function(e){"none"!==e.style.display&&(t=!1)}),t}(t)?"none":"block"})}}})),e.appendChild(BX.create("DIV",{props:{className:"custom-select__props-container"}})));if(i)for(a=0;a<d.controls.length;a++)if(BX.util.in_array(t.controlId,d.controls[a].showIn))if(d.controls[a].controlgroup){u=!1,h=BX.create("DIV",{props:{className:"custom-select__group"},html:'<span class="custom-select__title">'+d.controls[a].label+"</span>"});var l=BX.create("DIV",{props:{className:"custom-select__group-container"}});if(h&&d.controls[a].children&&d.controls[a].children.length&&0<d.controls[a].children.length){for(p=0;p<d.controls[a].children.length;p++)BX.util.in_array(t.controlId,d.controls[a].children[p].showIn)&&function(){u=!0;var t=d.controls[a].children[p].controlId;l.appendChild(BX.create("DIV",{props:{className:"custom-select__item"},dataset:{value:t},events:{click:BX.delegate(function(){var e=document.querySelector("[data-id="+o.id+"_select]");e.classList.remove("active"),e.querySelector(".custom-select__search-props").value="",Array.from(e.querySelectorAll(".custom-select__item")).forEach(function(e){e.style.display="block"}),Array.from(e.querySelectorAll(".custom-select__group")),this.CreateLevel(n,t),BX.style(i,"display","none"),BX.style(r,"display","")},d)},html:BX.util.htmlspecialchars(d.controls[a].children[p].label)}))}();u&&(h.appendChild(l),s.appendChild(h))}}else!function(){var t=d.controls[a].controlId;s.appendChild(BX.create("DIV",{props:{className:"custom-select__item"},dataset:{value:t},events:{click:BX.delegate(function(){var e=document.querySelector("[data-id="+o.id+"_select]");e.classList.remove("active"),e.querySelector(".custom-select__search-props").value="",Array.from(e.querySelectorAll(".custom-select__item")).forEach(function(e){e.style.display="block"}),Array.from(e.querySelectorAll(".custom-select__group")),this.CreateLevel(n,t),BX.style(i,"display","none"),BX.style(r,"display","")},d)},html:BX.util.htmlspecialchars(d.controls[a].label)}))}();r&&i?(o.link=r,o.customSelect=i,BX.bind(r,"click",BX.delegate(function(){BX.style(o.customSelect,"display",""),BX.style(o.link,"display","none"),BX.focus(o.customSelect)},o)),BX.bind(void 0,"change",BX.delegate(function(){0<o.select.selectedIndex&&this.CreateLevel(n,o.select.options[o.select.selectedIndex].value),o.select.selectedIndex=0,BX.style(o.customSelect,"display","none"),BX.style(o.link,"display","")},d)),BX.bind(i,"blur",BX.delegate(function(){o.select.selectedIndex=0,BX.style(o.customSelect,"display","none"),BX.style(o.link,"display","")},o)),BX.bind(void 0,"keypress",BX.delegate(function(e){if((e=e||c.event).keyCode&&(13===e.keyCode||27===e.keyCode)&&(13===e.keyCode&&0<o.select.selectedIndex&&this.CreateLevel(n),o.select.selectedIndex=0,BX.style(o.select,"display","none"),BX.style(o.link,"display",""),13===e.keyCode))return BX.PreventDefault(e)},d))):d.boolResult=!1}();if("object"===_typeof(e))return e.v}}else this.boolResult=!1;return this.boolResult},BX.TreeConditions.prototype.RenderCreateOneActionBtn=function(e,t){if(this.RenderCreateBtn(e,t)){BX.bind(e.addBtn.select,"change",function(){BX.hide(e.addBtn)}),BX.adjust(e.addBtn,{attrs:{"bx-data-create-one-action-btn":!0}});var i=BX.clone(e.addBtn.id,!0);BX.addCustomEvent("onAdminTabsDeleteLevel",function(e,t){t&&t.addBtn&&t.addBtn.getAttribute("bx-data-create-one-action-btn")&&t.addBtn.id===i&&BX.show(t.addBtn,"block")});e.children&&!function(e){if(null==e)return!0;if(e.length&&0<e.length)return!1;if(0===e.length)return!0;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}(e.children)&&BX.hide(e.addBtn)}return this.boolResult},BX.TreeConditions.prototype.RenderDeleteBtn=function(e,t,i){var s;return this.boolResult&&(e.container&&(s=e.container.appendChild(BX.create("DIV",{props:{id:e.id+"_del",className:"condition-delete",title:BX.type.isPlainObject(i.mess)&&BX.type.isNotEmptyString(i.mess.DELETE_CONTROL)?i.mess.DELETE_CONTROL:this.messTree.DELETE_CONTROL}})))?(e.delBtn=s,BX.bind(s,"click",BX.delegate(function(){this.DeleteLevel(e,t)},this)),BX.bind(e.container,"mouseover",BX.delegate(function(e){return BX.style(s,"display","block"),BX.eventCancelBubble(e)},this)),BX.bind(e.container,"mouseout",BX.delegate(function(e){return BX.style(s,"display","none"),BX.eventCancelBubble(e)},this))):this.boolResult=!1),this.boolResult},BX.TreeConditions.prototype.CreateLogic=function(e,t,i){var s,l;return this.boolResult&&(e.logic&&"object"===_typeof(e.logic)?this.boolResult=this.UpdateLogic(e,i):(l="condition-logic",i.style&&(l=l.concat(" ",i.style)),(s=BX.create("DIV",{props:{className:l},style:{zIndex:parseInt(BX.style(e.wrapper,"z-index"),10)+1},html:i.message}))?(e.wrapper.insertBefore(s,e.wrapper.childNodes[0]),e.logic=s,BX.bind(e.logic,"click",i.visual)):this.boolResult=!1)),this.boolResult},BX.TreeConditions.prototype.DeleteLogic=function(e){return this.boolResult&&e.logic&&"object"===_typeof(e.logic)&&(BX.unbindAll(e.logic),e.logic=BX.remove(e.logic)),this.boolResult},BX.TreeConditions.prototype.UpdateLogic=function(e,t){var i;return this.boolResult&&e.logic&&"object"===_typeof(e.logic)&&(i="condition-logic",t.style&&(i=i.concat(" ",t.style)),BX.adjust(e.logic,{props:{className:i},html:t.message})),this.boolResult},BX.TreeConditions.prototype.SearchVisual=function(e){var t,i,s,l,n,o,r,a=-1;if(this.boolResult&&e.visual&&"object"===_typeof(e.visual)&&e.visual.controls){for(s in t={},e.visual.controls)e.visual.controls.hasOwnProperty(s)&&(t[i=e.visual.controls[s]]=e.values[i]);if(e.visual.values)for(l=0;l<e.visual.values.length;l++){for(n in o=e.visual.values[l],r=!0,t)if(o[n]!=t[n]){r=!1;break}if(r){a=l;break}}}return a},BX.TreeConditions.prototype.ChangeVisual=function(e){var t,i,s;if(this.boolResult&&-1<(t=this.SearchVisual(e)))for(i=e.visual.logic[t],s=0;s<e.children.length;s++)e.children[s]&&this.UpdateLogic(e.children[s],i);return this.boolResult},BX.TreeConditions.prototype.NextVisual=function(e){var t,i,s,l,n;if(this.boolResult){if(-1<(t=this.SearchVisual(e))){for(l in++t>=e.visual.logic.length&&(t=0),i=e.visual.values[t])i.hasOwnProperty(l)&&(e.values[l]=i[l]);for(s=0;s<e.obj.length;s++)e.obj[s].ReInitValue(e.visual.controls);for(n=e.visual.logic[t],s=0;s<e.children.length;s++)e.children[s]&&this.UpdateLogic(e.children[s],n)}BX.onCustomEvent("onNextVisualChange",[e])}})}(window),document.addEventListener("DOMContentLoaded",function(){closeCustomSelects(),searchMetaProps()});