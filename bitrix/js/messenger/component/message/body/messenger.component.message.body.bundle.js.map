{"version":3,"file":"messenger.component.message.body.bundle.js","sources":["messenger.component.message.body.js"],"sourcesContent":["import \"./messenger.component.message.body.css\";\n\n/**\n * Bitrix Messenger\n * Message Vue component\n *\n * @package bitrix\n * @subpackage im\n * @copyright 2001-2019 Bitrix\n */\n\nconst BX = window.BX;\n\nconst MessageType = Object.freeze({\n\tself: 'self',\n\topponent: 'opponent',\n\tsystem: 'system',\n});\n\nconst ContentType = Object.freeze({\n\tdefault: 'default',\n\timage: 'image',\n\tvideo: 'video',\n\trichLink: 'richLink',\n});\n\nconst MessengerStore = Object.freeze({\n\tfiles: BX.Messenger.Model.Files.getName(),\n});\n\nBX.Vue.component('bx-messenger-message-body',\n{\n\t/**\n\t * @emits 'clickByUserName' {user: object, event: MouseEvent}\n\t */\n\tprops:\n\t{\n\t\tuserId: { default: 0 },\n\t\tdialogId: { default: 0 },\n\t\tchatId: { default: 0 },\n\t\tmessageType: { default: MessageType.self },\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\tdefault: BX.Messenger.Model.Messages.getMessageBlank\n\t\t},\n\t\tuser: {\n\t\t\ttype: Object,\n\t\t\tdefault: BX.Messenger.Model.Users.getUserBlank\n\t\t},\n\t\tfiles: {\n\t\t\ttype: Object,\n\t\t\tdefault: {}\n\t\t},\n\t\tenableEmotions: { default: true },\n\t\tshowName: { default: true },\n\t\tshowAvatar: { default: true },\n\t\treferenceContentBodyClassName: { default: ''},\n\t},\n\tcreated()\n\t{\n\t\tthis.dateFormatFunction = null;\n\t\tthis.cacheFormatDate = {};\n\t},\n\tmethods:\n\t{\n\t\tclickByUserName(user, event)\n\t\t{\n\t\t\tthis.$emit('clickByUserName', {user, event})\n\t\t},\n\t\tformatDate(date)\n\t\t{\n\t\t\tconst id = date.toJSON().slice(0, 10);\n\n\t\t\tif (this.cacheFormatDate[id])\n\t\t\t{\n\t\t\t\treturn this.cacheFormatDate[id];\n\t\t\t}\n\n\t\t\tlet dateFormat = BX.Messenger.Utils.getDateFormatType(\n\t\t\t\tBX.Messenger.Const.dateFormat.message,\n\t\t\t\tthis.$root.$bitrixMessages\n\t\t\t);\n\n\t\t\tthis.cacheFormatDate[id] = this._getDateFormat().format(dateFormat, date);\n\n\t\t\treturn this.cacheFormatDate[id];\n\t\t},\n\t\t_getDateFormat()\n\t\t{\n\t\t\tif (this.dateFormatFunction)\n\t\t\t{\n\t\t\t\treturn this.dateFormatFunction;\n\t\t\t}\n\n\t\t\tthis.dateFormatFunction = Object.create(BX.Main.Date);\n\t\t\tif (this.$root.$bitrixMessages)\n\t\t\t{\n\t\t\t\tthis.dateFormatFunction._getMessage = (phrase) => this.$root.$bitrixMessages[phrase];\n\t\t\t}\n\n\t\t\treturn this.dateFormatFunction;\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tMessageType: () => MessageType,\n\t\tContentType: () => ContentType,\n\n\t\tcontentType()\n\t\t{\n\t\t\tif (this.filesData.length > 0)\n\t\t\t{\n\t\t\t\tlet onlyImage = false;\n\t\t\t\tlet onlyVideo = false;\n\n\t\t\t\tfor (let file of this.filesData)\n\t\t\t\t{\n\t\t\t\t\tif (file.type == 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (onlyVideo)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonlyVideo = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonlyImage = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (false && file.type == 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (onlyImage)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonlyImage = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonlyVideo = true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tonlyImage = false;\n\t\t\t\t\t\tonlyVideo = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (onlyImage)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.image;\n\t\t\t\t}\n\t\t\t\telse if (onlyVideo)\n\t\t\t\t{\n\t\t\t\t\treturn ContentType.video;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ContentType.default;\n\t\t},\n\n\t\tlocalize()\n\t\t{\n\t\t\treturn BX.Vue.getFilteredPhrases('IM_MESSENGER_MESSAGE_', this.$root.$bitrixMessages);\n\t\t},\n\n\t\tformattedDate()\n\t\t{\n\t\t\treturn this.formatDate(this.message.date);\n\t\t},\n\n\t\tmessageText()\n\t\t{\n\t\t\tif (this.isDeleted)\n\t\t\t{\n\t\t\t\treturn this.localize.IM_MESSENGER_MESSAGE_DELETED;\n\t\t\t}\n\n\t\t\treturn this.message.textConverted;\n\t\t},\n\n\t\tisEdited()\n\t\t{\n\t\t\treturn this.message.params.IS_EDITED == 'Y';\n\t\t},\n\n\t\tisDeleted()\n\t\t{\n\t\t\treturn this.message.params.IS_DELETED == 'Y';\n\t\t},\n\n\t\tfilesData()\n\t\t{\n\t\t\tlet files = [];\n\n\t\t\tif (!this.message.params.FILE_ID || this.message.params.FILE_ID.length <= 0)\n\t\t\t{\n\t\t\t\treturn files;\n\t\t\t}\n\n\t\t\tthis.message.params.FILE_ID.forEach(fileId => {\n\t\t\t\tif (this.files[fileId])\n\t\t\t\t{\n\t\t\t\t\tfiles.push(this.files[fileId]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn files;\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-content-wrap\">\n\t\t\t<template v-if=\"contentType == ContentType.default\">\n\t\t\t\t<div class=\"bx-im-message-content\">\n\t\t\t\t\t<span class=\"bx-im-message-content-box\">\n\t\t\t\t\t\t<template v-if=\"showName && messageType == MessageType.opponent\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-content-name\" :style=\"{color: user.color}\" @click=\"clickByUserName(user, $event)\">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body', referenceContentBodyClassName]\">\n\t\t\t\t\t\t\t<template v-for=\"file in filesData\">\n\t\t\t\t\t\t\t\t<bx-messenger-element-file :file=\"file\"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body-wrap', {\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-with-text': messageText.length > 0,\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-without-text': messageText.length <= 0,\n\t\t\t\t\t\t\t}]\">\n\t\t\t\t\t\t\t\t<template v-if=\"messageText\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-text\" v-html=\"messageText\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-params\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-date\">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- keyboard -->\n\t\t\t</template>\n\t\t\t<template v-else-if=\"contentType == ContentType.richLink\">\n\t\t\t\t<!-- richLink type markup -->\n\t\t\t</template>\n\t\t\t<template v-else-if=\"contentType == ContentType.image || contentType == ContentType.video\">\n\t\t\t\t<div class=\"bx-im-message-content bx-im-message-content-fit\">\n\t\t\t\t\t<span class=\"bx-im-message-content-box\">\n\t\t\t\t\t\t<template v-if=\"showName && messageType == MessageType.opponent\">\n\t\t\t\t\t\t\t<div class=\"bx-im-message-content-name\" :style=\"{color: user.color}\" @click=\"clickByUserName(user, $event)\">{{!showAvatar? user.name: (user.firstName? user.firstName: user.name)}}</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body', referenceContentBodyClassName]\">\n\t\t\t\t\t\t\t<template v-if=\"contentType == ContentType.image\">\n\t\t\t\t\t\t\t\t<template v-for=\"file in filesData\">\n\t\t\t\t\t\t\t\t\t<bx-messenger-element-file-image :file=\"file\"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else-if=\"contentType == ContentType.video\">\n\t\t\t\t\t\t\t\t<template v-for=\"file in filesData\">\n\t\t\t\t\t\t\t\t\t<bx-messenger-element-file-video :file=\"file\"/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<div :class=\"['bx-im-message-content-body-wrap', {\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-with-text': messageText.length > 0,\n\t\t\t\t\t\t\t\t'bx-im-message-content-body-without-text': messageText.length <= 0,\n\t\t\t\t\t\t\t}]\">\n\t\t\t\t\t\t\t\t<template v-if=\"messageText\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-text\" v-html=\"messageText\"></span>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-params\">\n\t\t\t\t\t\t\t\t\t<span class=\"bx-im-message-content-date\">{{formattedDate}}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<!-- keyboard -->\n\t\t\t</template>\n\t\t</div>\n\t`\n});\n\n/*\n\t<span class=\"bx-messenger-content-item-like bx-messenger-content-like-digit-off\">\n\t\t<span>&nbsp;</span>\n\t\t<span class=\"bx-messenger-content-like-digit\"></span>\n\t\t<span data-messageid=\"28571160\" class=\"bx-messenger-content-like-button\">{{localize.IM_MESSENGER_MESSAGE_LIKE}}</span>\n\t</span>\n */"],"names":["BX","window","MessageType","Object","freeze","self","opponent","system","ContentType","default","image","video","richLink","MessengerStore","files","Messenger","Model","Files","getName","Vue","component","props","userId","dialogId","chatId","messageType","message","type","Messages","getMessageBlank","user","Users","getUserBlank","enableEmotions","showName","showAvatar","referenceContentBodyClassName","created","dateFormatFunction","cacheFormatDate","methods","clickByUserName","event","$emit","formatDate","date","id","toJSON","slice","dateFormat","Utils","getDateFormatType","Const","$root","$bitrixMessages","_getDateFormat","format","create","Main","Date","_getMessage","phrase","computed","contentType","filesData","length","onlyImage","onlyVideo","file","localize","getFilteredPhrases","formattedDate","messageText","isDeleted","IM_MESSENGER_MESSAGE_DELETED","textConverted","isEdited","params","IS_EDITED","IS_DELETED","FILE_ID","forEach","fileId","push","template"],"mappings":";;;CAEA;;;;;;;;;CASA,IAAMA,EAAE,GAAGC,MAAM,CAACD,EAAlB;;CAEA,IAAME,YAAW,GAAGC,MAAM,CAACC,MAAP,CAAc;CACjCC,EAAAA,IAAI,EAAE,MAD2B;CAEjCC,EAAAA,QAAQ,EAAE,UAFuB;CAGjCC,EAAAA,MAAM,EAAE;CAHyB,CAAd,CAApB;;CAMA,IAAMC,YAAW,GAAGL,MAAM,CAACC,MAAP,CAAc;CACjCK,EAAAA,OAAO,EAAE,SADwB;CAEjCC,EAAAA,KAAK,EAAE,OAF0B;CAGjCC,EAAAA,KAAK,EAAE,OAH0B;CAIjCC,EAAAA,QAAQ,EAAE;CAJuB,CAAd,CAApB;;CAOA,IAAMC,cAAc,GAAGV,MAAM,CAACC,MAAP,CAAc;CACpCU,EAAAA,KAAK,EAAEd,EAAE,CAACe,SAAH,CAAaC,KAAb,CAAmBC,KAAnB,CAAyBC,OAAzB;CAD6B,CAAd,CAAvB;CAIAlB,EAAE,CAACmB,GAAH,CAAOC,SAAP,CAAiB,2BAAjB,EACA;CACC;;;CAGAC,EAAAA,KAAK,EACL;CACCC,IAAAA,MAAM,EAAE;CAAEb,MAAAA,OAAO,EAAE;CAAX,KADT;CAECc,IAAAA,QAAQ,EAAE;CAAEd,MAAAA,OAAO,EAAE;CAAX,KAFX;CAGCe,IAAAA,MAAM,EAAE;CAAEf,MAAAA,OAAO,EAAE;CAAX,KAHT;CAICgB,IAAAA,WAAW,EAAE;CAAEhB,MAAAA,OAAO,EAAEP,YAAW,CAACG;CAAvB,KAJd;CAKCqB,IAAAA,OAAO,EAAE;CACRC,MAAAA,IAAI,EAAExB,MADE;CAERM,MAAAA,OAAO,EAAET,EAAE,CAACe,SAAH,CAAaC,KAAb,CAAmBY,QAAnB,CAA4BC;CAF7B,KALV;CASCC,IAAAA,IAAI,EAAE;CACLH,MAAAA,IAAI,EAAExB,MADD;CAELM,MAAAA,OAAO,EAAET,EAAE,CAACe,SAAH,CAAaC,KAAb,CAAmBe,KAAnB,CAAyBC;CAF7B,KATP;CAaClB,IAAAA,KAAK,EAAE;CACNa,MAAAA,IAAI,EAAExB,MADA;CAENM,MAAAA,OAAO,EAAE;CAFH,KAbR;CAiBCwB,IAAAA,cAAc,EAAE;CAAExB,MAAAA,OAAO,EAAE;CAAX,KAjBjB;CAkBCyB,IAAAA,QAAQ,EAAE;CAAEzB,MAAAA,OAAO,EAAE;CAAX,KAlBX;CAmBC0B,IAAAA,UAAU,EAAE;CAAE1B,MAAAA,OAAO,EAAE;CAAX,KAnBb;CAoBC2B,IAAAA,6BAA6B,EAAE;CAAE3B,MAAAA,OAAO,EAAE;CAAX;CApBhC,GALD;CA2BC4B,EAAAA,OA3BD,qBA4BC;CACC,SAAKC,kBAAL,GAA0B,IAA1B;CACA,SAAKC,eAAL,GAAuB,EAAvB;CACA,GA/BF;CAgCCC,EAAAA,OAAO,EACP;CACCC,IAAAA,eADD,2BACiBX,IADjB,EACuBY,KADvB,EAEC;CACC,WAAKC,KAAL,CAAW,iBAAX,EAA8B;CAACb,QAAAA,IAAI,EAAJA,IAAD;CAAOY,QAAAA,KAAK,EAALA;CAAP,OAA9B;CACA,KAJF;CAKCE,IAAAA,UALD,sBAKYC,IALZ,EAMC;CACC,UAAMC,EAAE,GAAGD,IAAI,CAACE,MAAL,GAAcC,KAAd,CAAoB,CAApB,EAAuB,EAAvB,CAAX;;CAEA,UAAI,KAAKT,eAAL,CAAqBO,EAArB,CAAJ,EACA;CACC,eAAO,KAAKP,eAAL,CAAqBO,EAArB,CAAP;CACA;;CAED,UAAIG,UAAU,GAAGjD,EAAE,CAACe,SAAH,CAAamC,KAAb,CAAmBC,iBAAnB,CAChBnD,EAAE,CAACe,SAAH,CAAaqC,KAAb,CAAmBH,UAAnB,CAA8BvB,OADd,EAEhB,KAAK2B,KAAL,CAAWC,eAFK,CAAjB;CAKA,WAAKf,eAAL,CAAqBO,EAArB,IAA2B,KAAKS,cAAL,GAAsBC,MAAtB,CAA6BP,UAA7B,EAAyCJ,IAAzC,CAA3B;CAEA,aAAO,KAAKN,eAAL,CAAqBO,EAArB,CAAP;CACA,KAtBF;CAuBCS,IAAAA,cAvBD,4BAwBC;CAAA;;CACC,UAAI,KAAKjB,kBAAT,EACA;CACC,eAAO,KAAKA,kBAAZ;CACA;;CAED,WAAKA,kBAAL,GAA0BnC,MAAM,CAACsD,MAAP,CAAczD,EAAE,CAAC0D,IAAH,CAAQC,IAAtB,CAA1B;;CACA,UAAI,KAAKN,KAAL,CAAWC,eAAf,EACA;CACC,aAAKhB,kBAAL,CAAwBsB,WAAxB,GAAsC,UAACC,MAAD;CAAA,iBAAY,KAAI,CAACR,KAAL,CAAWC,eAAX,CAA2BO,MAA3B,CAAZ;CAAA,SAAtC;CACA;;CAED,aAAO,KAAKvB,kBAAZ;CACA;CArCF,GAjCD;CAwECwB,EAAAA,QAAQ,EACR;CACC5D,IAAAA,WAAW,EAAE;CAAA,aAAMA,YAAN;CAAA,KADd;CAECM,IAAAA,WAAW,EAAE;CAAA,aAAMA,YAAN;CAAA,KAFd;CAICuD,IAAAA,WAJD,yBAKC;CACC,UAAI,KAAKC,SAAL,CAAeC,MAAf,GAAwB,CAA5B,EACA;CACC,YAAIC,SAAS,GAAG,KAAhB;CACA,YAAIC,SAAS,GAAG,KAAhB;CAFD;CAAA;CAAA;;CAAA;CAIC,+BAAiB,KAAKH,SAAtB,8HACA;CAAA,gBADSI,IACT;;CACC,gBAAIA,IAAI,CAACzC,IAAL,IAAa,OAAjB,EACA;CACC,kBAAIwC,SAAJ,EACA;CACCA,gBAAAA,SAAS,GAAG,KAAZ;CACA;CACA;;CACDD,cAAAA,SAAS,GAAG,IAAZ;CACA,aARD,MASK,AAUL;CACCA,cAAAA,SAAS,GAAG,KAAZ;CACAC,cAAAA,SAAS,GAAG,KAAZ;CACA;CACA;CACD;CA9BF;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;;CAgCC,YAAID,SAAJ,EACA;CACC,iBAAO1D,YAAW,CAACE,KAAnB;CACA,SAHD,MAIK,IAAIyD,SAAJ,EACL;CACC,iBAAO3D,YAAW,CAACG,KAAnB;CACA;CACD;;CAED,aAAOH,YAAW,CAACC,OAAnB;CACA,KAlDF;CAoDC4D,IAAAA,QApDD,sBAqDC;CACC,aAAOrE,EAAE,CAACmB,GAAH,CAAOmD,kBAAP,CAA0B,uBAA1B,EAAmD,KAAKjB,KAAL,CAAWC,eAA9D,CAAP;CACA,KAvDF;CAyDCiB,IAAAA,aAzDD,2BA0DC;CACC,aAAO,KAAK3B,UAAL,CAAgB,KAAKlB,OAAL,CAAamB,IAA7B,CAAP;CACA,KA5DF;CA8DC2B,IAAAA,WA9DD,yBA+DC;CACC,UAAI,KAAKC,SAAT,EACA;CACC,eAAO,KAAKJ,QAAL,CAAcK,4BAArB;CACA;;CAED,aAAO,KAAKhD,OAAL,CAAaiD,aAApB;CACA,KAtEF;CAwECC,IAAAA,QAxED,sBAyEC;CACC,aAAO,KAAKlD,OAAL,CAAamD,MAAb,CAAoBC,SAApB,IAAiC,GAAxC;CACA,KA3EF;CA6ECL,IAAAA,SA7ED,uBA8EC;CACC,aAAO,KAAK/C,OAAL,CAAamD,MAAb,CAAoBE,UAApB,IAAkC,GAAzC;CACA,KAhFF;CAkFCf,IAAAA,SAlFD,uBAmFC;CAAA;;CACC,UAAIlD,KAAK,GAAG,EAAZ;;CAEA,UAAI,CAAC,KAAKY,OAAL,CAAamD,MAAb,CAAoBG,OAArB,IAAgC,KAAKtD,OAAL,CAAamD,MAAb,CAAoBG,OAApB,CAA4Bf,MAA5B,IAAsC,CAA1E,EACA;CACC,eAAOnD,KAAP;CACA;;CAED,WAAKY,OAAL,CAAamD,MAAb,CAAoBG,OAApB,CAA4BC,OAA5B,CAAoC,UAAAC,MAAM,EAAI;CAC7C,YAAI,MAAI,CAACpE,KAAL,CAAWoE,MAAX,CAAJ,EACA;CACCpE,UAAAA,KAAK,CAACqE,IAAN,CAAW,MAAI,CAACrE,KAAL,CAAWoE,MAAX,CAAX;CACA;CACD,OALD;CAOA,aAAOpE,KAAP;CACA;CAnGF,GAzED;CA8KCsE,EAAAA,QAAQ;CA9KT,CADA;CAmPA;;;;;;;;;;"}