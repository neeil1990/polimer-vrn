{"version":3,"file":"script.js","sources":["src/factory.js","src/utils.js","src/reference/field.js","src/basket/summaryskeleton.js","src/basket/cis.js","src/basket/digital.js","src/bracketchain.js","src/basket/itemview.js","src/basket/itemedit.js","src/basket/field.js","src/basketconfirm/field.js","src/box/itemview.js","src/box/itemedit.js","src/box/collection.js","src/shipment/field.js","src/property/field.js","src/print/field.js","src/notification/field.js","src/index.js","src/compatible/editor.js"],"sourcesContent":["const BX = window.BX;\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tname: 'yamarket',\r\n\t\tmap: {},\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tregister() {\r\n\t\tif (this.isEditorInitialized()) {\r\n\t\t\tthis.registerEditorMethod();\r\n\t\t} else {\r\n\t\t\tthis.handleEditorInit(true);\r\n\t\t}\r\n\t}\r\n\r\n\tisEditorInitialized() {\r\n\t\treturn BX.UI?.EntityEditorControlFactory?.initialized;\r\n\t}\r\n\r\n\tregisterEditorMethod() {\r\n\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod(this.options.name, this.build);\r\n\t}\r\n\r\n\thandleEditorInit(dir) {\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](window, 'BX.UI.EntityEditorControlFactory:onInitialize', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (factory, event) => {\r\n\t\tevent.methods[this.options.name] = this.build;\r\n\t\tthis.handleEditorInit(false);\r\n\t}\r\n\r\n\tbuild = (type, controlId, settings) => {\r\n\t\tconst prefix = this.options.name + '_';\r\n\r\n\t\tif (type.indexOf(prefix) !== 0) { return null; }\r\n\r\n\t\tconst internalType = type.substr(prefix.length);\r\n\r\n\t\tif (!this.options.map.hasOwnProperty(internalType)) { return null; }\r\n\r\n\t\tconst fieldClass = this.options.map[internalType];\r\n\r\n\t\treturn fieldClass.create(controlId, settings);\r\n\t}\r\n}","export function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}\r\n\r\nexport function pascalCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word) => word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function camelCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) => index === 0 ? word.toLowerCase() : word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function kebabCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) =>  word.toLowerCase())\r\n\t\t.join('-');\r\n}\r\n\r\nexport function copyValues(from, to) {\r\n\tconst fromValues = collectValues(from);\r\n\r\n\treturn fillValues(to, fromValues);\r\n}\r\n\r\nexport function collectValues(container) {\r\n\tconst inputs = findInputs(container);\r\n\tconst result = {};\r\n\r\n\tfor (const [name, input] of Object.entries(inputs)) {\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tif (!option.selected) { continue; }\r\n\r\n\t\t\t\tresult[name] = option.value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult[name] = input.value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function fillValues(container, values) {\r\n\tconst inputs = findInputs(container);\r\n\tlet isChanged = false;\r\n\r\n\tfor (const [name, value] of Object.entries(values)) {\r\n\t\tif (inputs[name] == null) { continue; }\r\n\r\n\t\tconst input = inputs[name];\r\n\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tconst selected = (option.value === value);\r\n\r\n\t\t\t\tif (selected === Boolean(option.selected)) { continue; }\r\n\r\n\t\t\t\toption.selected = selected;\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (input.value === value) { continue; }\r\n\r\n\t\t\tisChanged = true;\r\n\t\t\tinput.value = value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn isChanged;\r\n}\r\n\r\nexport function findInputs(container) {\r\n\tconst inputs = container.querySelectorAll('input, select, textarea');\r\n\tconst result = {};\r\n\r\n\tfor (const input of inputs) {\r\n\t\tif (!input.name) { continue; }\r\n\r\n\t\tresult[input.name] = input;\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function replaceTemplateVariables(template, variables) {\r\n\tlet result = template;\r\n\r\n\tif (variables == null) { return result; }\r\n\r\n\tfor (const [key, value] of Object.entries(variables)) {\r\n\t\tresult = result.replace('#' + key + '#', value);\r\n\t}\r\n\r\n\treturn result;\r\n}","import {replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Field extends BX.UI.EntityEditorField {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._hasLayout = false;\r\n\t\tthis.options = this.constructor.defaults != null\r\n\t\t\t? Object.assign({}, this.constructor.defaults)\r\n\t\t\t: {};\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.constructor.messages[key] || super.getMessage(key);\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tclearLayout() {\r\n\t\tif (!this._hasLayout) { return; }\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\t\tthis._hasLayout = false;\r\n\t}\r\n\r\n\tlayout(options) {\r\n\t\tif (this._hasLayout) { return; }\r\n\r\n\t\tthis.ensureWrapperCreated({});\r\n\t\tthis.adjustWrapper();\r\n\r\n\t\tif (!this.isNeedToDisplay()) {\r\n\t\t\tthis.registerLayout(options);\r\n\t\t\tthis._hasLayout = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\r\n\t\t}\r\n\r\n\t\tif (this.useTitle()) {\r\n\t\t\tconst title = this.getTitle();\r\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\r\n\t\t}\r\n\r\n\t\tthis.render(this.getValue());\r\n\r\n\t\tif (this.isContextMenuEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\r\n\t\t}\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis.initializeDragDropAbilities();\r\n\t\t}\r\n\r\n\t\tthis.registerLayout(options);\r\n\t\tthis._hasLayout = true;\r\n\t}\r\n\r\n\tforget() {}\r\n\r\n\trender(payload) {}\r\n\r\n\tuseTitle() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelectorAll(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelectorAll(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelector(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelector(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n}","import {copyValues, replaceTemplateVariables} from \"../utils\";\r\nimport './summary.css';\r\n\r\nexport default class SummarySkeleton {\r\n\r\n\tstatic STATUS_READY = 'READY';\r\n\tstatic STATUS_WAIT = 'WAIT';\r\n\tstatic STATUS_EMPTY = 'EMPTY';\r\n\r\n\tstatic defaults = {\r\n\t\tmodalElement: '.yamarket-item-summary__modal',\r\n\t\tstatusElement: '.yamarket-item-summary__status',\r\n\t\tinputElement: 'input',\r\n\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tonChange: null,\r\n\t};\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleStatusClick(true);\r\n\t}\r\n\r\n\thandleStatusClick(dir) {\r\n\t\tconst status = this.getElement('status');\r\n\r\n\t\tif (status == null) { return; }\r\n\r\n\t\tstatus[dir ? 'addEventListener' : 'removeEventListener']('click', this.onStatusClick);\r\n\t}\r\n\r\n\tonStatusClick = (evt) => {\r\n\t\tthis.openDialog();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tsetup(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tbuild() {\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildStatus() {\r\n\t\tconst cises = this.optionValue();\r\n\t\tconst status = this.getStatus(cises);\r\n\r\n\t\treturn `<a class=\"yamarket-item-summary__status\" href=\"#\" data-status=\"${status}\">${this.getMessage('SUMMARY_' + status)}</a>`\r\n\t}\r\n\r\n\treflowStatus() {\r\n\t\tconst value = this.formValue();\r\n\t\tconst status = this.getStatus(value);\r\n\t\tconst element = this.getElement('status');\r\n\r\n\t\telement.setAttribute('data-status', status);\r\n\t\telement.textContent = this.getMessage('SUMMARY_' + status);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {any} value\r\n\t *\r\n\t * @return {string}\r\n\t */\r\n\tgetStatus(value) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {string} */\r\n\tbuildForm(useFormValue = false) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\treflowForm() {\r\n\t\tconst modal = this.el.querySelector('.yamarket-item-summary__modal');\r\n\r\n\t\tmodal.innerHTML = this.buildForm(true);\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\toptionValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\tformValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\topenDialog() {\r\n\t\tconst modal = this.getElement('modal').firstElementChild;\r\n\t\tconst options  = this.dialogOptions();\r\n\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create(options);\r\n\r\n\t\tmessageBox.setMessage(modal.cloneNode(true));\r\n\t\tmessageBox.setButtons([\r\n\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t]);\r\n\r\n\t\tmessageBox.show();\r\n\t\tcopyValues(this.el, messageBox.popupWindow.contentContainer);\r\n\t}\r\n\r\n\tdialogOptions() {\r\n\t\treturn {\r\n\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t};\r\n\t}\r\n\r\n\tonSaveClick(messageBox) {\r\n\t\tconst isChanged = copyValues(messageBox.popupWindow.contentContainer, this.el);\r\n\r\n\t\tif (isChanged && this.options.onChange) {\r\n\t\t\tthis.options.onChange();\r\n\t\t}\r\n\r\n\t\tthis.reflowStatus();\r\n\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tonCancelClick(messageBox) {\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.options.messages[key] || key;\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelectorAll(selector);\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelector(selector);\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {fillValues, replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Cis extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\tcopyElement: '.yamarket-item-summary__copy',\r\n\t\tinputElement: 'input, select',\r\n\t\ttitle: '',\r\n\t\ttotal: 0,\r\n\t\tmarkingGroup: false,\r\n\t\tmarkingType: null,\r\n\t\tinstances: [],\r\n\t\tinstanceTypes: [],\r\n\t\tinternalInstances: [],\r\n\t})\r\n\r\n\tbind() {\r\n\t\tsuper.bind();\r\n\t\tthis.handleCopyClick(true);\r\n\t}\r\n\r\n\thandleCopyClick(dir) {\r\n\t\tconst copy = this.getElement('copy');\r\n\r\n\t\tif (copy == null) { return; }\r\n\r\n\t\tcopy[dir ? 'addEventListener' : 'removeEventListener']('click', this.onCopyClick);\r\n\t}\r\n\r\n\tonCopyClick = (evt) => {\r\n\t\tthis.copyInternal();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.total = count;\r\n\t\tthis.reflowStatus();\r\n\t\tthis.reflowForm();\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tif (this.requiredTypes().length === 0) { return '&mdash;'; }\r\n\r\n\t\tconst internalCises = this.optionValue('internal');\r\n\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t${this.emptyValues(internalCises) ? '' : this.buildCopyIcon()}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildCopyIcon() {\r\n\t\treturn `<button class=\"yamarket-item-summary__copy\" type=\"button\" title=\"${this.getMessage('COPY')}\">\r\n\t\t\t${this.getMessage('COPY')}\r\n\t\t</button>`;\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\t\tconst value = useFormValue ? this.formValue() : this.optionValue();\r\n\t\tconst types = this.requiredTypes();\r\n\r\n\t\treturn `<table class=\"ui-form yamarket-cis-table\">\r\n\t\t\t<thead class=\"yamarket-cis-table__head\">\r\n\t\t\t\t<td></td>\r\n\t\t\t\t${types.map((type) => `<td>${this.getMessage('HEAD_' + type)}</td>`).join('')}\r\n\t\t\t</thead>\r\n\t\t\t\r\n\t\t\t${iterator.map((dummy, index) => {\r\n\t\t\t\treturn `<tr>\r\n\t\t\t\t\t<td class=\"yamarket-cis-table__number\">\r\n\t\t\t\t\t\t&numero;${index + 1}\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t${types.map((type) => {\r\n\t\t\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\t\t\tconst one = value[name] ?? '';\r\n\t\t\t\t\t\tconst placeholder = this.hasMessage('PLACEHOLDER_' + type) ? this.getMessage('PLACEHOLDER_' + type) : '';\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn `\r\n\t\t\t\t\t\t\t<td class=\"yamarket-cis-table__control type-count--${types.length}\">\r\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.inputName(name)}\" value=\"${BX.util.htmlspecialchars(one)}\" data-name=\"${name}\" placeholder=\"${placeholder}\" />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t`;\r\n\t\t\t\t\t}).join('')}\r\n\t\t\t\t</tr>`;\r\n\t\t\t}).join('')}\r\n\t\t\t${types.includes('CIS') && this.fixedCisType() == null ? \r\n\t\t\t\t`<tr>\r\n\t\t\t\t\t<td></td>\r\n\t\t\t\t\t<td class=\"yamarket-cis-table__type\">\r\n\t\t\t\t\t\t<div class=\"yamarket-cis-table__type-label\">\r\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('FORMAT')}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"yamarket-cis-table__type-value\">\r\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t\t\t\t\t\t<select class=\"ui-ctl-element\" name=\"${this.inputName('TYPE')}\" data-name=\"TYPE\">\r\n\t\t\t\t\t\t\t\t\t${['CIS', 'UIN'].map((typeVariant) => {\r\n\t\t\t\t\t\t\t\t\t\treturn `<option value=\"${typeVariant}\" ${typeVariant === value['TYPE'] ? 'selected' : ''}>${this.getMessage(typeVariant)}</option>`;\r\n\t\t\t\t\t\t\t\t\t}).join('')}\r\n\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>`\r\n\t\t\t : ''}\r\n\t\t</table>`;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tlet result;\r\n\r\n\t\tif (this.filledCount(value) >= this.options.total) {\r\n\t\t\tresult = SummarySkeleton.STATUS_READY;\r\n\t\t} else {\r\n\t\t\tresult = SummarySkeleton.STATUS_WAIT;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\temptyValues(values) {\r\n\t\tconst types = this.requiredTypes();\r\n\t\tlet empty = true;\r\n\r\n\t\tfor (let index = 0; index < this.options.total; ++index) {\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\tconst value = (values[name] ?? '').trim();\r\n\r\n\t\t\t\tif (value !== '') {\r\n\t\t\t\t\tempty = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!empty) { break; }\r\n\t\t}\r\n\r\n\t\treturn empty;\r\n\t}\r\n\r\n\tfilledCount(values) {\r\n\t\tconst types = this.requiredTypes();\r\n\t\tlet filled = 0;\r\n\r\n\t\tfor (let index = 0; index < this.options.total; ++index) {\r\n\t\t\tlet itemFilled = true;\r\n\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tconst name = `ITEMS[${index}][${type}]`;\r\n\t\t\t\tconst value = (values[name] ?? '').trim();\r\n\r\n\t\t\t\tif (value === '') {\r\n\t\t\t\t\titemFilled = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (itemFilled) {\r\n\t\t\t\t++filled;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn filled;\r\n\t}\r\n\r\n\tcopyInternal(container = this.el) {\r\n\t\tconst values = Object.assign({}, this.formValue(), this.optionValue('internal'));\r\n\t\tconst isChanged = fillValues(container, this.makeInputValues(values));\r\n\r\n\t\tif (!isChanged) { return; }\r\n\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tmakeInputValues(values) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const [key, value] of Object.entries(values)) {\r\n\t\t\tresult[this.inputName(key)] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tinputName(selfName: string) : string {\r\n\t\tconst bracketPosition = selfName.indexOf('[');\r\n\t\tlet result;\r\n\r\n\t\tif (bracketPosition > 0) {\r\n\t\t\tresult =\r\n\t\t\t\tthis.options.name\r\n\t\t\t\t+ `[${selfName.substring(0, bracketPosition)}]`\r\n\t\t\t\t+ `${selfName.substring(bracketPosition)}`\r\n\t\t} else {\r\n\t\t\tresult = this.options.name + `[${selfName}]`;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tformValue() {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const input of this.fewElements('input')) {\r\n\t\t\tconst name = String(input.dataset.name).trim();\r\n\t\t\tconst value = input.value.trim();\r\n\r\n\t\t\tif (name === '' || value === '') { continue; }\r\n\r\n\t\t\tresult[name] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue(optionKey = null) {\r\n\t\tconst instances = optionKey != null ? this.options[optionKey + 'Instances'] : this.options.instances;\r\n\t\tconst types = this.requiredTypes();\r\n\t\tconst result = {};\r\n\t\tconst fixedType = this.fixedCisType();\r\n\t\tconst cisTypes = this.cisTypes();\r\n\t\tlet index = 0;\r\n\r\n\t\tif (!Array.isArray(instances)) { return result; }\r\n\r\n\t\tfor (const instance of instances) {\r\n\t\t\tfor (const type of types) {\r\n\t\t\t\tlet value = (instance[type] ?? '').trim();\r\n\t\t\t\tlet valueType = type;\r\n\r\n\t\t\t\tif (value === '' && type === 'CIS' && fixedType == null) {\r\n\t\t\t\t\tvalue = (instance['UIN'] ?? '').trim();\r\n\t\t\t\t\tvalueType = 'UIN';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value !== '') {\r\n\t\t\t\t\tresult[`ITEMS[${index}][${type}]`] = value;\r\n\r\n\t\t\t\t\tif (cisTypes.includes(valueType)) {\r\n\t\t\t\t\t\tresult['TYPE'] = valueType;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\r\n\t\tif (fixedType == null && result['TYPE'] == null && this.options.markingType != null) {\r\n\t\t\tresult['TYPE'] = this.options.markingType;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcisTypes() {\r\n\t\treturn [ 'UIN', 'CIS' ];\r\n\t}\r\n\r\n\tfixedCisType() {\r\n\t\tconst option = (this.options.instanceTypes || []);\r\n\r\n\t\tfor (const type of this.cisTypes()) {\r\n\t\t\tif (option.includes(type)) {\r\n\t\t\t\treturn type;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\trequiredTypes() : Array {\r\n\t\tconst result = (this.options.instanceTypes || []).slice();\r\n\t\tlet foundCis = false;\r\n\r\n\t\tfor (const type of this.cisTypes()) {\r\n\t\t\tif (result.includes(type)) {\r\n\t\t\t\tfoundCis = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!foundCis && this.options.markingGroup) {\r\n\t\t\tresult.unshift('CIS');\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdialogOptions() {\r\n\t\treturn {\r\n\t\t\ttitle: this.options.title,\r\n\t\t\tminWidth: Math.max(400, Math.min(1200, this.requiredTypes().length * 400))\r\n\t\t};\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_CIS_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n\r\n\thasMessage(key) {\r\n\t\treturn this.getMessage(key) !== key;\r\n\t}\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {collectValues, replaceTemplateVariables} from \"../utils\";\r\nimport {BracketChain} from \"../bracketchain\";\r\n\r\nexport default class Digital extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\titems: [],\r\n\t\ttotal: 0,\r\n\t})\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.total = count;\r\n\t\tthis.reflowStatus();\r\n\t\tthis.reflowForm();\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst formValue = useFormValue ? this.formValue() : this.optionValue();\r\n\r\n\t\treturn `<div class=\"ui-form\">\r\n\t\t\t${this.buildFormCodes(total, formValue)}\r\n\t\t\t${this.buildFormAdditional(total, formValue)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildFormCodes(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\r\n\t\treturn iterator.map((dummy, index) => {\r\n\t\t\tconst oneValue = formValue?.ITEM?.[index] || {};\r\n\r\n\t\t\tlet title = '';\r\n\t\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('CODE')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][CODE]\" value=\"${BX.util.htmlspecialchars(oneValue['CODE'] || '')}\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ACTIVATE_TILL')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-datetime ui-ctl-w100\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-calendar\"></div>\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][ACTIVATE_TILL]\" value=\"${BX.util.htmlspecialchars(oneValue['ACTIVATE_TILL'] || '')}\" onclick=\"BX.calendar({node: this, field: this, bTime: false, bHideTime: true})\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>`;\r\n\r\n\t\t\tif (hasFew) {\r\n\t\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('GROUP', { 'NUMBER': index + 1 })}</div>`;\r\n\t\t\t}\r\n\r\n\t\t\treturn title + fieldset;\r\n\t\t}).join('');\r\n\t}\r\n\r\n\tbuildFormAdditional(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tlet title = '';\r\n\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('SLIP')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<textarea class=\"ui-entity-editor-field-textarea\" name=\"${this.options.name}[SLIP]\" rows=\"5\" required>${BX.util.htmlspecialchars(formValue['SLIP'] || '')}</textarea>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\r\n\t\tif (hasFew) {\r\n\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('ADDITIONAL')}</div>`;\r\n\t\t}\r\n\r\n\t\treturn title + fieldset;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tconst filledItems = this.filterFilledItems(value.ITEM);\r\n\t\tconst isItemsFilled = filledItems.length >= this.options.total;\r\n\t\tconst isSlipFilled = (value['SLIP'] != null && value['SLIP'].trim() !== '');\r\n\r\n\t\treturn (\r\n\t\t\tisItemsFilled && isSlipFilled\r\n\t\t\t\t? SummarySkeleton.STATUS_READY\r\n\t\t\t\t: SummarySkeleton.STATUS_WAIT\r\n\t\t);\r\n\t}\r\n\r\n\tfilterFilledItems(items) {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['CODE'] == null || item['CODE'].trim() === '') { continue; }\r\n\t\t\tif (item['ACTIVATE_TILL'] == null || item['ACTIVATE_TILL'].trim() === '') { continue; }\r\n\r\n\t\t\tresult.push(item);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue() {\r\n\t\tconst items = Array.isArray(this.options.items) ? this.options.items : [];\r\n\t\tlet slip = '';\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['SLIP'] != null && item['SLIP'] !== '') {\r\n\t\t\t\tslip = item['SLIP'];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t'ITEM': items,\r\n\t\t\t'SLIP': slip,\r\n\t\t};\r\n\t}\r\n\r\n\tformValue() {\r\n\t\tconst rawValues = collectValues(this.el);\r\n\t\tconst values = BracketChain.toTree(rawValues, this.options.name);\r\n\t\tconst defaults = {\r\n\t\t\t'ITEM': [],\r\n\t\t\t'SLIP': '',\r\n\t\t};\r\n\r\n\t\treturn Object.assign(defaults, values);\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_DIGITAL_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n}","export class BracketChain {\r\n\r\n\tstatic toTree(values, base = null) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const key in values) {\r\n\t\t\tif (!values.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tconst keyRelative = this.keyRelative(key, base);\r\n\r\n\t\t\tif (keyRelative == null) { continue; }\r\n\r\n\t\t\tconst keyChain = this.valueKeyChain(keyRelative);\r\n\r\n\t\t\tthis.setValueByKeyChain(result, keyChain, values[key]);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic keyRelative(key, base) {\r\n\t\tif (base == null) { return key; }\r\n\t\tif (key.indexOf(base) !== 0) { return null; }\r\n\r\n\t\treturn key.replace(base, '');\r\n\t}\r\n\r\n\tstatic valueKeyChain(key) {\r\n\t\tconst parts = key.split('[');\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const part of parts) {\r\n\t\t\tif (part === '' && result.length === 0) { continue; }\r\n\r\n\t\t\tconst name = part.replace(/]$/, '');\r\n\r\n\t\t\tresult.push(name);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic setValueByKeyChain(result, chain, value) {\r\n\t\tconst lastKey = chain.pop();\r\n\t\tlet level = result;\r\n\r\n\t\tfor (let index = 0; index < chain.length; ++index) {\r\n\t\t\tconst key = chain[index];\r\n\t\t\tconst nextKey = (index + 1 === chain.length) ? lastKey : chain[index + 1];\r\n\r\n\t\t\tif (level[key] == null) {\r\n\t\t\t\tlevel[key] = /^\\d+$/.test(nextKey) ? [] : {};\r\n\t\t\t}\r\n\r\n\t\t\tlevel = level[key];\r\n\t\t}\r\n\r\n\t\tlevel[lastKey] = value;\r\n\t}\r\n\r\n}","import Cis from \"./cis\";\r\nimport Digital from \"./digital\";\r\nimport { htmlToElement, pascalCase, kebabCase } from \"../utils\";\r\n\r\nexport default class ItemView {\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t\tname: null,\r\n\t\ttitle: null,\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis._wires = [];\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.forgetWires();\r\n\t\tthis.options = {};\r\n\t}\r\n\r\n\tgetMessage(key) {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tgetTitle() {\r\n\t\treturn this.options.title;\r\n\t}\r\n\r\n\textendOptions(item) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\ttitle: item['NAME'],\r\n\t\t});\r\n\t}\r\n\r\n\trender(item, basket) {\r\n\t\tconst columns = Object.keys(basket.COLUMNS);\r\n\r\n\t\tcolumns.unshift('INDEX');\r\n\r\n\t\tthis.forgetWires();\r\n\t\tthis.extendOptions(item);\r\n\r\n\t\tthis.el = htmlToElement(`<tr>\r\n\t\t\t${columns.map((key) => this.renderColumn(item, key)).join('')}\r\n\t\t\t${this.renderActions()}\r\n\t\t</tr>`, 'tbody');\r\n\r\n\t\tthis.setupWires();\r\n\t}\r\n\r\n\tmount(point) {\r\n\t\tpoint.appendChild(this.el);\r\n\t}\r\n\r\n\trenderColumn(item, key) {\r\n\t\tconst method = 'column' + pascalCase(key);\r\n\r\n\t\treturn (\r\n\t\t\tmethod in this\r\n\t\t\t\t? this[method](item, key)\r\n\t\t\t\t: this.columnDefault(item, key)\r\n\t\t);\r\n\t}\r\n\r\n\tcolumnIndex(item, key) {\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('ID')}\" value=\"${this.value(item, 'ID')}\" />\r\n\t\t\t${this.valueFormatted(item, key)}\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tcolumnCis(item, key) {\r\n\t\tconst cis = new Cis({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('IDENTIFIERS'),\r\n\t\t\ttitle: this.value(item, 'NAME'),\r\n\t\t\tmarkingType: this.value(item, 'MARKING_TYPE'),\r\n\t\t\tmarkingGroup: !!this.value(item, 'MARKING_GROUP'),\r\n\t\t\tinstanceTypes: this.value(item, 'INSTANCE_TYPES'),\r\n\t\t\ttotal: this.value(item, 'COUNT'),\r\n\t\t\tinstances: this.value(item, 'INSTANCES'),\r\n\t\t\tinternalInstances: this.value(item, 'INTERNAL_INSTANCES'),\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t});\r\n\r\n\t\tthis.wire(key, cis);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\" data-wire=\"${key}\">${cis.build()}</td>`;\r\n\t}\r\n\r\n\tcolumnDigital(item, key) {\r\n\t\tconst digital = new Digital({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('DIGITAL'),\r\n\t\t\ttotal: this.value(item, 'COUNT'),\r\n\t\t\titems: this.value(item, 'DIGITAL'),\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t});\r\n\r\n\t\tthis.wire(key, digital);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\" data-wire=\"${key}\">${digital.build()}</td>`;\r\n\t}\r\n\r\n\tcolumnSubsidy(item, key) {\r\n\t\tconst promos = this.value(item, 'PROMOS');\r\n\t\tlet content = this.valueFormatted(item, key);\r\n\r\n\t\tif (promos != null && Array.isArray(promos)) {\r\n\t\t\tcontent += promos.map((promo) => `<div>${promo}</div>`).join('');\r\n\t\t}\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">${content}</td>`;\r\n\t}\r\n\r\n\tcolumnCount(item, key) {\r\n\t\tconst value = this.value(item, key);\r\n\t\tconst valueSanitized = parseFloat(value) || '';\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t${this.valueFormatted(item, key)} ${this.getMessage('ITEM_UNIT')}\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tcolumnDefault(item, key) {\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">${this.valueFormatted(item, key)}</td>`;\r\n\t}\r\n\r\n\trenderActions() {\r\n\t\treturn '';\r\n\t}\r\n\r\n\twire(key, instance) {\r\n\t\tthis._wires[key] = instance;\r\n\t}\r\n\r\n\tforgetWires() {\r\n\t\tthis._wires = {};\r\n\t}\r\n\r\n\tsetupWires() {\r\n\t\tfor (const [key, instance] of Object.entries(this._wires)) {\r\n\t\t\tconst column = this.el.querySelector(`[data-wire=\"${key}\"]`);\r\n\t\t\tconst element = column.firstElementChild;\r\n\r\n\t\t\tif (!element) { continue; }\r\n\r\n\t\t\tinstance.setup(element);\r\n\t\t}\r\n\t}\r\n\r\n\tcallWires(method, args = []) {\r\n\t\tfor (const [, instance] of Object.entries(this._wires)) {\r\n\t\t\tif (typeof instance[method] !== 'function') { return; }\r\n\r\n\t\t\tinstance[method].apply(instance, args);\r\n\t\t}\r\n\t}\r\n\r\n\tvalueFormatted(item, key) {\r\n\t\tconst formattedKey = key + '_FORMATTED';\r\n\t\tlet result = '';\r\n\r\n\t\tif (item[formattedKey] != null) {\r\n\t\t\tresult = item[formattedKey];\r\n\t\t} else if (item[key] != null) {\r\n\t\t\tresult = item[key];\r\n\t\t}\r\n\r\n\t\treturn result !== '' ? result : '&mdash;';\r\n\t}\r\n\r\n\tvalue(item, key) {\r\n\t\treturn item[key];\r\n\t}\r\n\r\n\tgetName(field) {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n\r\n\thasAction(type) {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport {kebabCase} from \"../utils\";\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\tstatic ACTION_ITEM = 'item';\r\n\tstatic ACTION_CIS = 'cis';\r\n\tstatic ACTION_DIGITAL = 'digital';\r\n\r\n\tstatic defaults = Object.assign({}, ItemView.defaults)\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleInputChange(false);\r\n\t\tthis.handleDeleteToggle(false);\r\n\t}\r\n\r\n\thandleInputChange(dir) {\r\n\t\tif (!this.options.onChange) { return; }\r\n\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.name === this.getName('COUNT')) {\r\n\t\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.onCountChange);\r\n\t\t\t}\r\n\r\n\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.options.onChange);\r\n\t\t});\r\n\t}\r\n\r\n\thandleDeleteToggle(dir) {\r\n\t\tconst input = this.el.querySelector('.yamarket-delete-toggle__input');\r\n\r\n\t\tif (!this.hasAction(ItemEdit.ACTION_ITEM) || !input) { return; }\r\n\r\n\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.onDeleteToggle);\r\n\t}\r\n\r\n\tonCountChange = (evt) => {\r\n\t\tconst count = parseInt(evt.target.value);\r\n\r\n\t\tif (isNaN(count)) { return; }\r\n\r\n\t\tthis.callWires('updateTotal', [count]);\r\n\t}\r\n\r\n\tonDeleteToggle = (evt) => {\r\n\t\tconst isDelete = !!evt.target.checked;\r\n\r\n\t\tthis.el.classList.toggle('is--delete', isDelete);\r\n\t\tthis.disableInput(isDelete);\r\n\t}\r\n\r\n\tdisableInput(dir) {\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.name === this.getName('DELETE')) { return; }\r\n\r\n\t\t\tinput.readonly = dir;\r\n\r\n\t\t\tif (input.classList.contains('ui-ctl-element')) {\r\n\t\t\t\tinput.parentElement.classList.toggle('ui-ctl-disabled', dir);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetCountDiff() {\r\n\t\tconst needDelete = this.getInputValue('DELETE');\r\n\t\tconst initialCount = parseInt(this.getInputValue('INITIAL_COUNT'));\r\n\t\tconst count = parseInt(this.getInputValue('COUNT'));\r\n\t\tlet result;\r\n\r\n\t\tif (needDelete) {\r\n\t\t\tresult = initialCount;\r\n\t\t} else {\r\n\t\t\tresult = initialCount - count;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(item, basket) {\r\n\t\tsuper.render(item, basket);\r\n\t\tthis.handleInputChange(true);\r\n\t\tthis.handleDeleteToggle(true);\r\n\t}\r\n\r\n\tcolumnCount(item, key) {\r\n\t\tif (!this.hasAction(ItemEdit.ACTION_ITEM)) { return super.columnCount(item, key); }\r\n\r\n\t\tconst value = this.value(item, key);\r\n\t\tconst valueSanitized = parseFloat(value) || '';\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tclass=\"ui-ctl-element\"\r\n\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\tname=\"${this.getName('COUNT')}\"\r\n\t\t\t\t\tvalue=\"${valueSanitized}\"\r\n\t\t\t\t\tmin=\"1\"\r\n\t\t\t\t\tmax=\"${valueSanitized}\"\r\n\t\t\t\t\tstep=\"1\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\trenderActions() {\r\n\t\tif (!this.hasAction(ItemEdit.ACTION_ITEM)) { return ''; }\r\n\r\n\t\treturn `<td class=\"for--delete\">\r\n\t\t\t<label class=\"yamarket-delete-toggle\">\r\n\t\t\t\t<input class=\"yamarket-delete-toggle__input\" type=\"checkbox\" name=\"${this.getName('DELETE')}\" value=\"Y\" />\r\n\t\t\t\t<span class=\"yamarket-delete-toggle__icon icon--delete\" title=\"${this.getMessage('ITEM_DELETE')}\">${this.getMessage('ITEM_DELETE')}</span>\r\n\t\t\t\t<span class=\"yamarket-delete-toggle__icon icon--restore\" title=\"${this.getMessage('ITEM_RESTORE')}\">${this.getMessage('ITEM_RESTORE')}</span>\r\n\t\t\t</label>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tgetInputValue(field) {\r\n\t\tconst input = this.getInput(field);\r\n\t\tlet result;\r\n\r\n\t\tif (input == null) { return null; }\r\n\r\n\t\tif (input.type === 'checkbox') {\r\n\t\t\tresult = input.checked ? input.value : null;\r\n\t\t} else {\r\n\t\t\tresult = input.value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetInput(field) {\r\n\t\tconst name = this.getName(field);\r\n\r\n\t\treturn this.el.querySelector(`input[name=\"${name}\"]`);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport ItemView from \"./itemview\";\r\nimport ItemEdit from \"./itemedit\";\r\nimport { htmlToElement, kebabCase } from \"../utils\";\r\nimport './basket.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BASKET',\r\n\t\tactions: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcountChanges() {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (!(item instanceof ItemEdit)) { continue; }\r\n\r\n\t\t\tconst diff = item.getCountDiff();\r\n\r\n\t\t\tif (diff > 0) {\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tname: item.getTitle(),\r\n\t\t\t\t\tdiff: diff,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tconst basket = payload['VALUE'];\r\n\t\tconst table = this.renderTable(basket);\r\n\t\tconst body = table.querySelector('tbody');\r\n\r\n\t\tthis.extendOptions(payload);\r\n\r\n\t\tthis.renewItems(basket.ITEMS).forEach((basketItem, index) => {\r\n\t\t\tbasketItem.render(basket.ITEMS[index], basket);\r\n\t\t\tbasketItem.mount(body);\r\n\t\t});\r\n\r\n\t\tthis._wrapper.appendChild(table);\r\n\t}\r\n\r\n\textendOptions(payload) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\tactions: payload['ACTIONS'],\r\n\t\t});\r\n\t}\r\n\r\n\trenewItems(payloadItems) {\r\n\t\tthis.destroyItems();\r\n\r\n\t\treturn this.createItems(payloadItems);\r\n\t}\r\n\r\n\tdestroyItems() {\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcreateItems(payloadItems) {\r\n\t\tlet itemIndex = 0;\r\n\r\n\t\tthis.items = [];\r\n\r\n\t\tfor (const payloadItem of payloadItems) {\r\n\t\t\tthis.items.push(this.createItem(itemIndex));\r\n\t\t\t++itemIndex;\r\n\t\t}\r\n\r\n\t\treturn this.items;\r\n\t}\r\n\r\n\tcreateItem(index) {\r\n\t\tconst options = {\r\n\t\t\tmessages: Field.messages,\r\n\t\t\tname: `${this.options.name}[${index}]`,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.hasAction(ItemEdit.ACTION_CIS) || this.hasAction(ItemEdit.ACTION_DIGITAL)\r\n\t\t\t\t? () => {\r\n\t\t\t\t\tif (this._mode !== BX.UI.EntityEditorMode.edit) {\r\n\t\t\t\t\t\tthis._mode = BX.UI.EntityEditorMode.edit;\r\n\t\t\t\t\t\tthis._editor.showToolPanel();\r\n\t\t\t\t\t\tthis._editor.registerActiveControl(this);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._changeHandler();\r\n\t\t\t\t}\r\n\t\t\t\t: this._changeHandler,\r\n\t\t};\r\n\r\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\trenderTable(basket) {\r\n\t\treturn htmlToElement(`<div class=\"yamarket-basket\">\r\n\t\t\t<div class=\"yamarket-basket-table-viewport\">\r\n\t\t\t\t<table class=\"yamarket-basket-table\">\r\n\t\t\t\t\t${this.renderHeader(basket)}\r\n\t\t\t\t\t<tbody></tbody>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t\t${this.renderSummary(basket)}\r\n\t\t</div>`);\r\n\t}\r\n\r\n\trenderHeader(basket) {\r\n\t\treturn `<thead>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"for--index\">&numero;</td>\r\n\t\t\t\t${Object.keys(basket.COLUMNS)\r\n\t\t\t\t\t.map((key) => `<td class=\"for--${kebabCase(key)}\">${this.columnTitle(basket, key)}</td>`)\r\n\t\t\t\t\t.join('')}\r\n\t\t\t\t${this.isInEditMode() && this.hasAction(ItemEdit.ACTION_ITEM) ? '<td class=\"for--delete\">&nbsp;</td>' : ''}\r\n\t\t\t</tr>\r\n\t\t</thead>`;\r\n\t}\r\n\r\n\tcolumnTitle(basket, key) {\r\n\t\tconst langKey = 'HEADER_' + key;\r\n\t\tconst lang = this.getMessage(langKey);\r\n\r\n\t\treturn lang !== langKey ? lang : basket.COLUMNS[key];\r\n\t}\r\n\r\n\trenderSummary(basket) {\r\n\t\tif (basket.SUMMARY.length === 0) { return ''; }\r\n\r\n\t\treturn `<div class=\"yamarket-basket-summary\">\r\n\t\t\t${basket.SUMMARY\r\n\t\t\t\t.map((item) => {\r\n\t\t\t\t\treturn `<div class=\"yamarket-basket-summary__row\">\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__label\">${item['NAME']}:</div>\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__value\">${item['VALUE']}</div>\r\n\t\t\t\t\t</div>`;\r\n\t\t\t\t})\r\n\t\t\t\t.join('')}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\thasAction(type) {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport { htmlToElement, copyValues } from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BASKET_CONFIRM',\r\n\t\treasons: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tvalidate(validator) {\r\n\t\tconst basket = this._parent.getChildById('BASKET');\r\n\r\n\t\tif (basket == null) { return; }\r\n\r\n\t\tconst countChanges = basket.countChanges();\r\n\r\n\t\tif (countChanges.length === 0) { return; }\r\n\r\n\t\treturn this.showDialog(countChanges, validator);\r\n\t}\r\n\r\n\tshowDialog(countChanges, validator) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create({\r\n\t\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t\t\tmessage: this.dialogBody(countChanges),\r\n\t\t\t});\r\n\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SendButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSendClick.bind(this, messageBox, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, validator, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogBody(countChanges) {\r\n\t\treturn `\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('REASON')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t${this.reasonControl()}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('PRODUCTS')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t${this.productsControl(countChanges)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-alert ui-alert-warning\">${this.getMessage('FORM_INTRO')}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\treasonControl() {\r\n\t\treturn `<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t<select class=\"ui-ctl-element\" name=\"${this.options.name}[REASON]\">\r\n\t\t\t\t${this.options.reasons.map((option) => `<option value=\"${option['ID']}\">${option['VALUE']}</option>`).join('')}\r\n\t\t\t</select>\r\n\t\t</div>`\r\n\t}\r\n\r\n\tproductsControl(changes) {\r\n\t\treturn changes\r\n\t\t\t.map((change) => {\r\n\t\t\t\treturn this.getMessage('ITEM_CHANGE', {\r\n\t\t\t\t\tNAME: change.name,\r\n\t\t\t\t\tCOUNT: change.diff,\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.join('<hr />');\r\n\t}\r\n\r\n\tonSendClick(messageBox, resolve) {\r\n\t\tcopyValues(messageBox.popupWindow.contentContainer, this.el);\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\tonCancelClick(messageBox, validator, resolve) {\r\n\t\tconst error = BX.UI.EntityValidationError.create({\r\n\t\t\tfield: this,\r\n\t\t});\r\n\r\n\t\tvalidator.addError(error);\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tthis.extendOptions(payload);\r\n\r\n\t\tthis.el = htmlToElement(`<div class=\"ui-helper-hidden\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.options.name}[REASON]\" value=\"\" />\r\n\t\t</div>`)\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\textendOptions(payload) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\treasons: payload['ITEMS_CHANGE_REASON'],\r\n\t\t});\r\n\t}\r\n}","import { htmlToElement } from \"../utils\";\r\nimport './box.css';\r\n\r\nexport default class ItemView {\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tboxProperties: {},\r\n\t\tboxDimensions: {},\r\n\t\tuseDimensions: false,\r\n\t\tfulfilmentBase: null,\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tgetMessage(key) {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tthis.options.useDimensions = enabled;\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.el = htmlToElement(`<div class=\"yamarket-box\">\r\n\t\t\t${this.buildDefined(value)}\r\n\t\t\t${this.buildHeader(value)}\r\n\t\t\t${this.buildBody(value)}\r\n\t\t</div>`);\r\n\t}\r\n\r\n\tbuildDefined(value) {\r\n\t\tconst keys = [\r\n\t\t\t'FULFILMENT_ID',\r\n\t\t];\r\n\t\tlet result = '';\r\n\r\n\t\tfor (const key of keys) {\r\n\t\t\tresult += `<input type=\"hidden\" name=\"${this.options.name}[${key}]\" value=\"${BX.util.htmlspecialchars(value[key] || '')}\" />`;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbuildSizes(value) {\r\n\t\tif (!this.options.useDimensions) { return ''; }\r\n\r\n\t\treturn `${Object.keys(this.options.boxDimensions).map((name) => {\r\n\t\t\tconst inputName = this.getName('DIMENSIONS') + `[${name}]`;\r\n\t\t\tconst inputValue = value?.DIMENSIONS?.[name]?.['VALUE'] || '';\r\n\t\t\t\r\n\t\t\tif (inputValue === '') { return ''; }\r\n\r\n\t\t\treturn `<input type=\"hidden\" name=\"${inputName}\" value=\"${BX.util.htmlspecialchars(inputValue)}\" data-name=\"${name}\" />`;\r\n\t\t}).join('')}`;\r\n\t}\r\n\r\n\tbuildHeader(value) {\r\n\t\treturn `<div class=\"yamarket-box__header\">\r\n\t\t\t<div class=\"yamarket-box__title\">\r\n\t\t\t\t${this.getMessage('BOX')}\r\n\t\t\t\t&numero;${value['NUMBER']}\r\n\t\t\t</div>\r\n\t\t\t${this.buildProperties(value)}\r\n\t\t\t${this.buildActions(value)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildProperties(value) {\r\n\t\tconst disabled = this.disabledProperties();\r\n\r\n\t\treturn `<div class=\"yamarket-box__properties\">\r\n\t\t\t${Object.entries(this.options.boxProperties).map(([name,property]) => {\r\n\t\t\t\tconst propertyValue = value?.PROPERTIES?.[name] || '';\r\n\t\t\t\t\r\n\t\t\t\tif (propertyValue === '' || disabled.indexOf(name) !== -1) { return ''; }\r\n\t\t\t\t\r\n\t\t\t\treturn `<div class=\"yamarket-box__property\">\r\n\t\t\t\t\t${property['NAME']}: ${propertyValue} ${property['UNIT_FORMATTED'] || ''}\r\n\t\t\t\t</div>`;\r\n\t\t\t}).join('')}\r\n\t\t</div>`\r\n\t}\r\n\r\n\tdisabledProperties() {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tbuildActions(value) {\r\n\t\treturn '';\r\n\t}\r\n\r\n\tbuildBody(value) {\r\n\t\treturn this.buildSizes(value);\r\n\t}\r\n\r\n\tmount(point, after) {\r\n\t\tif (after != null) {\r\n\t\t\tafter.after(this.el);\r\n\t\t} else {\r\n\t\t\tpoint.appendChild(this.el);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateNumber(number) {\r\n\t\tconst title = this.el.querySelector('.yamarket-box__title');\r\n\t\tconst fulfilmentId = this.el.querySelector('input[name$=\"[FULFILMENT_ID]\"]');\r\n\r\n\t\ttitle.innerHTML = `${this.getMessage('BOX')} &numero;${number}`;\r\n\t\tfulfilmentId.value = this.options.fulfilmentBase + number;\r\n\t}\r\n\r\n\tgetName(field) {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n\r\n\tfireChange() {\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport './box.css';\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleInputChange(false);\r\n\t\tthis.handleDeleteClick(false);\r\n\t}\r\n\r\n\thandleInputChange(dir) {\r\n\t\tif (!this.options.onChange) { return; }\r\n\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.type === 'hidden') { return; }\r\n\r\n\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.options.onChange);\r\n\t\t});\r\n\t}\r\n\r\n\thandleDeleteClick(dir) {\r\n\t\tconst button = this.el.querySelector('.yamarket-box__delete');\r\n\r\n\t\tif (!button) { return; }\r\n\r\n\t\tbutton[dir ? 'addEventListener' : 'removeEventListener']('click', this.onDeleteClick);\r\n\t}\r\n\r\n\tonDeleteClick = (evt) => {\r\n\t\tthis.remove();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tsuper.toggleUseDimensions(enabled);\r\n\r\n\t\tif (this.el == null) { return; }\r\n\r\n\t\tconst body = this.el.querySelector('.yamarket-box__body');\r\n\r\n\t\tif (body == null) { return; }\r\n\r\n\t\tif (enabled) {\r\n\t\t\tbody.classList.remove('is--disabled');\r\n\t\t} else {\r\n\t\t\tbody.classList.add('is--disabled');\r\n\t\t}\r\n\t}\r\n\r\n\tremove() {\r\n\t\tthis.fireRemove();\r\n\t\tthis.destroy();\r\n\t\tthis.el.remove();\r\n\t}\r\n\r\n\tfireRemove() {\r\n\t\tthis.el.dispatchEvent(new CustomEvent('yamarketBoxDelete', {\r\n\t\t\tdetail: {\r\n\t\t\t\titem: this,\r\n\t\t\t},\r\n\t\t\tbubbles: true,\r\n\t\t}));\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tsuper.render(value);\r\n\t\tthis.handleInputChange(true);\r\n\t\tthis.handleDeleteClick(true);\r\n\t}\r\n\r\n\tdisabledProperties() {\r\n\t\treturn [\r\n\t\t\t'SIZE',\r\n\t\t\t'WEIGHT',\r\n\t\t];\r\n\t}\r\n\r\n\tbuildActions(value) {\r\n\t\treturn `<div class=\"yamarket-box__actions\">\r\n\t\t\t<span class=\"yamarket-box__delete ui-entity-editor-header-edit-lnk\">${this.getMessage('BOX_DELETE')}</span>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildBody(value) {\r\n\t\treturn `<div class=\"yamarket-box__body ${this.options.useDimensions ? '' : 'is--disabled'}\">\r\n\t\t\t${this.buildSizes(value)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildSizes(value) {\r\n\t\treturn `<div class=\"yamarket-box__sizes\">\r\n\t\t\t${Object.entries(this.options.boxDimensions).map(([name, property]) => {\r\n\t\t\t\tconst inputName = this.getName('DIMENSIONS') + `[${name}]`;\r\n\t\t\t\tconst inputValue = value?.DIMENSIONS?.[name]?.['VALUE'] || '';\r\n\t\r\n\t\t\t\treturn `<div class=\"yamarket-box__size\">\r\n\t\t\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\r\n\t\t\t\t\t\t<div class=\"ui-entity-editor-block-title ui-entity-widget-content-block-title-edit\">\r\n\t\t\t\t            <label class=\"ui-entity-editor-block-title-text\">${property['NAME']}${property['UNIT_FORMATTED'] ? ', ' + property['UNIT_FORMATTED'] : ''}</label>\r\n\t\t\t\t        </div>\r\n\t\t\t\t        <div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t            <input class=\"ui-ctl-element\" type=\"text\" name=\"${inputName}\" value=\"${BX.util.htmlspecialchars(inputValue)}\" size=\"6\" data-name=\"${name}\" />\r\n\t\t\t\t        </div>\r\n\t\t\t       </div>\r\n\t\t\t\t</div>`;\r\n\t\t\t}).join('')}\r\n\t\t</div>`;\r\n\t}\r\n}","import ItemView from './itemview';\r\nimport ItemEdit from './itemedit';\r\nimport { htmlToElement } from \"../utils\";\r\n\r\nexport default class Collection {\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tboxProperties: {},\r\n\t\tboxDimensions: {},\r\n\t\tuseDimensions: false,\r\n\t\tfulfilmentBase: null,\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tgetMessage(key) {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\thandleItemRemove() {\r\n\t\tthis.el.addEventListener('yamarketBoxDelete', this.onItemRemove);\r\n\t}\r\n\r\n\thandleAddClick(button) {\r\n\t\tbutton.addEventListener('click', this.onAddClick);\r\n\t}\r\n\r\n\tonItemRemove = (evt) => {\r\n\t\tconst item = evt.detail.item;\r\n\r\n\t\tthis.releaseItem(item);\r\n\t\tthis.renewNumber();\r\n\t\tthis.fireChange();\r\n\t}\r\n\r\n\tonAddClick = (evt) => {\r\n\t\tthis.addItem();\r\n\t\tthis.fireChange();\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tthis.options.useDimensions = enabled;\r\n\r\n\t\tif (this.items == null) { return; }\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.toggleUseDimensions(enabled);\r\n\t\t}\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.renderSelf();\r\n\t\tthis.renderItems(value);\r\n\t\tthis.renderAddButton();\r\n\t}\r\n\r\n\trenderSelf() {\r\n\t\tthis.el = htmlToElement(`<div class=\"yamarket-boxes\"></div>`);\r\n\t}\r\n\r\n\trenderItems(value) {\r\n\t\tconst items = [];\r\n\t\tlet index = 0;\r\n\r\n\t\tfor (const one of value) {\r\n\t\t\tconst box = this.createItem(index);\r\n\r\n\t\t\tbox.render(one);\r\n\t\t\tbox.mount(this.el);\r\n\r\n\t\t\titems.push(box);\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\r\n\t\tthis.items = items;\r\n\t\tthis.nextIndex = index;\r\n\r\n\t\tthis.handleItemRemove();\r\n\t}\r\n\r\n\tcreateItem(index) {\r\n\t\tconst options = {\r\n\t\t\tname: this.options.name + `[${index}]`,\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tboxProperties: this.options.boxProperties,\r\n\t\t\tboxDimensions: this.options.boxDimensions,\r\n\t\t\tuseDimensions: this.options.useDimensions,\r\n\t\t\tfulfilmentBase: this.options.fulfilmentBase,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\r\n\t\tif (this.options.mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\treleaseItem(item) {\r\n\t\tconst index = this.items.indexOf(item);\r\n\r\n\t\tif (index === -1) { return; }\r\n\r\n\t\tthis.items.splice(index, 1);\r\n\t}\r\n\r\n\trenewNumber() {\r\n\t\tlet num = 1;\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tbox.updateNumber(num);\r\n\t\t\t++num;\r\n\t\t}\r\n\t}\r\n\r\n\taddItem() {\r\n\t\tconst number = this.items.length + 1;\r\n\t\tconst box = this.createItem(this.nextIndex);\r\n\t\tconst last = this.items[this.items.length - 1]?.el;\r\n\r\n\t\tbox.render({\r\n\t\t\t'FULFILMENT_ID': this.options.fulfilmentBase + number,\r\n\t\t\t'NUMBER': number,\r\n\t\t});\r\n\t\tbox.mount(this.el, last);\r\n\r\n\t\tthis.items.push(box);\r\n\t\t++this.nextIndex;\r\n\t}\r\n\r\n\trenderAddButton() {\r\n\t\tif (this.options.mode !== BX.UI.EntityEditorMode.edit) { return ''; }\r\n\r\n\t\tconst addButton = htmlToElement(`<span class=\"yamarket-boxes__add ui-entity-editor-content-create-lnk\">${this.getMessage('BOX_ADD')}</span>`);\r\n\r\n\t\tthis.el.appendChild(addButton);\r\n\t\tthis.handleAddClick(addButton);\r\n\t}\r\n\r\n\tfireChange() {\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t}\r\n\r\n\tmount(point) {\r\n\t\tpoint.appendChild(this.el);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport BoxCollection from \"../box/collection\";\r\nimport {htmlToElement} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'SHIPMENT',\r\n\t\tactions: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tinitialize(id, settings) {\r\n\t\tsuper.initialize(id, settings);\r\n\t\tthis.handleTitleActions(true);\r\n\t}\r\n\r\n\trelease() {\r\n\t\tthis.handleTitleActions(false);\r\n\t\tsuper.release();\r\n\t}\r\n\r\n\thandleTitleActions(dir) {\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](window, 'BX.UI.EntityEditorSection:onLayout', this.onTitleActions);\r\n\t}\r\n\r\n\thandleUseDimensionsChange(node, dir) {\r\n\t\tnode[dir ? 'addEventListener' : 'removeEventListener']('change', this.onUseDimensionsChange);\r\n\t}\r\n\r\n\tonTitleActions = (field, context) => {\r\n\t\tif (field !== this.getParent()) { return; }\r\n\r\n\t\tconst useDimensionsNode = field.isInEditMode()\r\n\t\t\t? this.renderUseDimensions(this.useDimensions)\r\n\t\t\t: this.definedUseDimensions(this.useDimensions);\r\n\r\n\t\tcontext.customNodes.push(useDimensionsNode);\r\n\t}\r\n\r\n\tonUseDimensionsChange = (evt) => {\r\n\t\tconst enabled = evt.target.checked;\r\n\r\n\t\tthis.toggleUseDimensions(enabled);\r\n\t\tthis.markAsChanged();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tthis.syncUseDimensions(payload['USE_DIMENSIONS']);\r\n\t\tthis.renderShipments(payload['VALUE'], {\r\n\t\t\tfulfilmentBase: payload['FULFILMENT_BASE'],\r\n\t\t\tboxProperties: payload['BOX_PROPERTIES'],\r\n\t\t\tboxDimensions: payload['BOX_DIMENSIONS'],\r\n\t\t\tuseDimensions: payload['USE_DIMENSIONS'],\r\n\t\t});\r\n\t}\r\n\r\n\tdefinedUseDimensions(enabled = false) {\r\n\t\treturn htmlToElement(`<input type=\"hidden\" name=\"USE_DIMENSIONS\" value=\"${enabled ? 'Y' : 'N'}\" />`);\r\n\t}\r\n\r\n\trenderUseDimensions(enabled = false) {\r\n\t\tconst node = htmlToElement(`<div class=\"ui-entity-editor-field-checkbox\">\r\n\t\t\t<input type=\"hidden\" name=\"USE_DIMENSIONS\" value=\"N\" />\r\n\t\t\t<label class=\"ui-ctl ui-ctl-xs ui-ctl-wa ui-ctl-checkbox yamarket-boxes-use-dimensions\">\r\n\t\t\t\t<input class=\"ui-ctl-element\" type=\"checkbox\" name=\"USE_DIMENSIONS\" value=\"Y\" ${enabled ? 'checked' : ''} />\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('USE_DIMENSIONS')}</div>\r\n\t\t\t</label>\r\n\t\t</div>`);\r\n\t\tconst checkbox = node.querySelector('input[type=\"checkbox\"]');\r\n\r\n\t\tthis.handleUseDimensionsChange(checkbox, true);\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\tsyncUseDimensions(enabled) {\r\n\t\tthis.useDimensions = enabled;\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tif (this.shipmentBoxes == null) { return; }\r\n\r\n\t\tfor (const boxCollection of this.shipmentBoxes) {\r\n\t\t\tboxCollection.toggleUseDimensions(enabled);\r\n\t\t}\r\n\t}\r\n\r\n\trenderShipmentTitle(shipment) {\r\n\t\tconst html = `<div class=\"ui-entity-editor-block-title\">\r\n\t\t\t<span class=\"ui-entity-editor-block-title-text\">${this.getMessage('SHIPMENT', { 'ID': shipment['ID'] })}</span>\r\n\t\t</div>`;\r\n\r\n\t\tthis._wrapper.insertAdjacentHTML('beforeend', html);\r\n\t}\r\n\r\n\trenderShipments(shipmentCollection, options) {\r\n\t\tthis.shipmentBoxes = [];\r\n\r\n\t\tif (!Array.isArray(shipmentCollection)) { shipmentCollection = []; }\r\n\r\n\t\tconst hasFew = shipmentCollection.length > 1;\r\n\t\tlet index = 0;\r\n\r\n\t\tfor (const shipment of shipmentCollection) {\r\n\t\t\tif (hasFew) {\r\n\t\t\t\tthis.renderShipmentTitle(shipment);\r\n\t\t\t}\r\n\r\n\t\t\tthis.renderShipment(shipment, Object.assign(options, {\r\n\t\t\t\tname: `${this.options.name}[${index}]`,\r\n\t\t\t}));\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\t}\r\n\r\n\trenderShipment(shipment, options) {\r\n\t\tthis.renderShipmentDefined(shipment, options);\r\n\t\tthis.renderBoxCollection(shipment['BOX'], options);\r\n\t}\r\n\r\n\trenderShipmentDefined(shipment, options) {\r\n\t\tconst keys = [\r\n\t\t\t'ID',\r\n\t\t];\r\n\r\n\t\tfor (const key of keys) {\r\n\t\t\tif (shipment[key] == null) { continue; }\r\n\r\n\t\t\tthis._wrapper.insertAdjacentHTML(\r\n\t\t\t\t'afterbegin',\r\n\t\t\t\t`<input type=\"hidden\" name=\"${options.name}[${key}]\" value=\"${shipment[key]}\" />`\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\trenderBoxCollection(shipment, options) {\r\n\t\tconst boxCollection = new BoxCollection(Object.assign(options, {\r\n\t\t\tmessages: Field.messages,\r\n\t\t\tmode: this._mode,\r\n\t\t\tname: options.name + '[BOX]',\r\n\t\t\tonChange: this._changeHandler,\r\n\t\t}));\r\n\r\n\t\tboxCollection.render(shipment);\r\n\t\tboxCollection.mount(this._wrapper);\r\n\r\n\t\tthis.shipmentBoxes.push(boxCollection);\r\n\t}\r\n}\r\n","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tbroadcastElement: '#YAMARKET_ORDER_VIEW',\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tuseTitle() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleActivityEnd(true);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleActivityEnd(false);\r\n\t}\r\n\r\n\thandleActivityEnd(dir) {\r\n\t\tif (this._activityType == null) { return; }\r\n\r\n\t\tconst broadcast = this.getElement('broadcast');\r\n\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](broadcast, 'yamarketActivitySubmitEnd', this.onActivityEnd);\r\n\t}\r\n\r\n\tonActivityEnd = (type) => {\r\n\t\tif (!this.isMatchActivity(type)) { return; }\r\n\r\n\t\tthis._editor.reload();\r\n\t}\r\n\r\n\tisMatchActivity(type) {\r\n\t\tif (type == null) { return false; }\r\n\r\n\t\treturn (type === this._activityType || type.indexOf(this._activityType + '|') === 0);\r\n\t}\r\n\r\n\tforget() {\r\n\t\tif (!this.el) { return; }\r\n\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tconst html = this.build(payload);\r\n\r\n\t\tthis._activityType = payload?.ACTIVITY_ACTION?.TYPE;\r\n\r\n\t\tthis.el = htmlToElement(html);\r\n\t\tthis.bind();\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\tbuild(payload) {\r\n\t\tconst activity = payload['ACTIVITY_ACTION'];\r\n\r\n\t\treturn `<div class=\"ui-entity-editor-content-block\">\r\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\r\n\t\t\t\t${BX.util.htmlspecialchars(payload['VALUE'])}\r\n\t\t\t\t${activity ? this.buildActivity(activity, payload) : ''}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildActivity(activity, property) {\r\n\t\tconst title = activity['TEXT'] !== property['NAME'] ? activity['TEXT'] : this.getMessage('ACTIVITY_APPLY');\r\n\t\tconst onclick = this.makeActivityMethod(activity);\r\n\r\n\t\treturn `<small>\r\n\t\t\t<a href=\"#\" onclick='${onclick}; return false'>${title}</a>\r\n\t\t</small>`;\r\n\t}\r\n\r\n\tmakeActivityMethod(activity) {\r\n\t\tlet result;\r\n\r\n\t\tif (activity['MENU'] != null) {\r\n\t\t\tconst items = activity['MENU'].map((action) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttext: action['TEXT'],\r\n\t\t\t\t\tonclick: action['METHOD'],\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tresult = `BX.PopupMenu.show(\"${activity['TYPE']}\", this, ${JSON.stringify(items)}, { angle: { offset: 50 } })`;\r\n\t\t} else {\r\n\t\t\tresult = activity['METHOD'];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport { htmlToElement } from \"../utils\";\r\nimport './print.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\turl: null,\r\n\t\twidth: 400,\r\n\t\theight: 300,\r\n\t\titems: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tbindDocumentsClick() {\r\n\t\tthis._wrapper.querySelectorAll('.yamarket-print__link').forEach((link) => {\r\n\t\t\tlink.addEventListener('click', this.onDocumentClick);\r\n\t\t});\r\n\t}\r\n\r\n\tonDocumentClick = (evt) => {\r\n\t\tconst link = evt.currentTarget;\r\n\t\tconst type = link.dataset.type;\r\n\t\tconst item = this.getItem(type);\r\n\t\tconst url = this.buildDocumentUrl(type);\r\n\t\tconst dialog = this.createDialog(url, item);\r\n\r\n\t\tdialog.Show();\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tgetItem(type) {\r\n\t\tlet result;\r\n\r\n\t\tfor (const document of this.options.items) {\r\n\t\t\tif (document['TYPE'] === type) {\r\n\t\t\t\tresult = document;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbuildDocumentUrl(type) {\r\n\t\tconst url = this.options.url;\r\n\r\n\t\treturn (\r\n\t\t\turl\r\n\t\t\t+ (url.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'type=' + type\r\n\t\t);\r\n\t}\r\n\r\n\tcreateDialog(url, item) {\r\n\t\treturn new BX.YandexMarket.PrintDialog({\r\n\t\t\ttitle: item.DIALOG_TITLE || item.TITLE,\r\n\t\t\tcontent_url: url,\r\n\t\t\twidth: item.WIDTH || this.options.width,\r\n\t\t\theight: item.HEIGHT || this.options.height,\r\n\t\t\tbuttons: [\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnSave,\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnCancel\r\n\t\t\t]\r\n\t\t});\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.extendOptions(value);\r\n\r\n\t\tthis.renderIntro();\r\n\t\tthis.renderDocuments(value['ITEMS']);\r\n\r\n\t\tthis.bindDocumentsClick();\r\n\t}\r\n\r\n\textendOptions(value) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\turl: value['URL'],\r\n\t\t\titems: value['ITEMS'],\r\n\t\t});\r\n\t}\r\n\r\n\trenderIntro() {\r\n\t\tconst element = htmlToElement(`<p class=\"yamarket-print__intro\">${this.getMessage('INTRO')}</p>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n\r\n\trenderDocuments(items) {\r\n\t\tif (!Array.isArray(items)) { return; }\r\n\r\n\t\tconst element = htmlToElement(`<ul class=\"yamarket-print__documents\">\r\n\t\t\t${items.map((document) => `<li class=\"yamarket-print__document\">\r\n\t\t\t\t<a class=\"yamarket-print__link\" href=\"#\" data-type=\"${document['TYPE']}\">${document['TITLE']}</a>\r\n\t\t\t</li>`).join('')}\r\n\t\t</ul>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport './notification.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tif (!Array.isArray(value)) { return; }\r\n\r\n\t\tconst html = value.map((one) => `<div class=\"ui-alert ui-alert-${one.type}\">${one.text}</div>`).join('');\r\n\r\n\t\tthis._wrapper.insertAdjacentHTML('beforeend', html);\r\n\t}\r\n\r\n}","import Factory from \"./factory\";\r\nimport Basket from \"./basket/field\";\r\nimport BasketConfirm from \"./basketconfirm/field\";\r\nimport Shipment from \"./shipment/field\";\r\nimport Property from \"./property/field\";\r\nimport Print from \"./print/field\";\r\nimport Notification from \"./notification/field\";\r\nimport Editor from \"./compatible/editor\";\r\nimport './common.css';\r\n\r\n// factory\r\n\r\nconst factory = new Factory({\r\n\tmap: {\r\n\t\tnotification: Notification,\r\n\t\tbasket: Basket,\r\n\t\tbasket_confirm: BasketConfirm,\r\n\t\tshipment: Shipment,\r\n\t\tproperty: Property,\r\n\t\tprint: Print,\r\n\t},\r\n});\r\n\r\nfactory.register();\r\n\r\n// compatible\r\n\r\nconst editor = new Editor();\r\n\r\neditor.start();\r\n\r\nexport {\r\n\tNotification,\r\n\tBasket,\r\n\tBasketConfirm,\r\n\tShipment,\r\n\tProperty,\r\n\tPrint,\r\n};","export default class Editor {\r\n\r\n\tstart() {\r\n\t\tthis.storeOriginDefault();\r\n\t\tthis.handleEditorInit();\r\n\t}\r\n\r\n\thandleEditorInit() {\r\n\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditor:onInit', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (editor, data) => {\r\n\t\tif (data.id !== 'yamarket_order_tab') { return; }\r\n\r\n\t\tthis.overrideEditor(editor);\r\n\t\tthis.overrideEditorAjax(editor);\r\n\t\tthis.restoreOriginDefault();\r\n\t}\r\n\r\n\tstoreOriginDefault() {\r\n\t\tthis._originDefault = BX?.UI?.EntityEditor?.getDefault();\r\n\t}\r\n\r\n\trestoreOriginDefault() {\r\n\t\tif (this._originDefault == null) { return; }\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tBX?.UI?.EntityEditor?.setDefault(this._originDefault);\r\n\t\t});\r\n\t}\r\n\r\n\toverrideEditor(editor) {\r\n\t\tconst createAjaxForm = editor.createAjaxForm;\r\n\r\n\t\tObject.assign(editor, {\r\n\t\t\tvalidate: this.editorValidate.bind(this, editor),\r\n\t\t\tcreateAjaxForm: this.editorCreateAjaxForm.bind(this, editor, createAjaxForm),\r\n\t\t});\r\n\t}\r\n\r\n\teditorValidate(editor, result) {\r\n\t\tconst validator = BX.UI.EntityAsyncValidator.create();\r\n\r\n\t\tfor (const control of editor._activeControls) {\r\n\t\t\tvalidator.addResult(control.validate(result));\r\n\t\t}\r\n\r\n\t\tif (this._userFieldManager) {\r\n\t\t\tvalidator.addResult(this._userFieldManager.validate(result));\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(validator.validate());\r\n\t}\r\n\r\n\teditorCreateAjaxForm(editor, parentMethod, options, callbacks) {\r\n\t\tconst result = parentMethod.call(editor, options, callbacks);\r\n\r\n\t\tthis.overrideAjaxForm(result);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toverrideEditorAjax(editor) {\r\n\t\tthis.overrideAjaxForm(editor._ajaxForm);\r\n\t}\r\n\r\n\toverrideAjaxForm(ajaxForm) {\r\n\t\tif (!ajaxForm || !BX?.UI?.ComponentAjax || !(ajaxForm instanceof BX.UI.ComponentAjax)) { return; }\r\n\r\n\t\tObject.assign(ajaxForm, {\r\n\t\t\tdoSubmit: this.ajaxFormDoSubmit,\r\n\t\t});\r\n\t}\r\n\r\n\tajaxFormDoSubmit(options) {\r\n\t\tconst formData = this._elementNode\r\n\t\t\t? BX.ajax.prepareForm(this._elementNode)\r\n\t\t\t: {data : BX.clone(this._formData), filesCount : 0};\r\n\r\n\t\tif (BX.type.isPlainObject(options.data)) {\r\n\t\t\tfor (const i in options.data) {\r\n\t\t\t\tif (!options.data.hasOwnProperty(i)) { continue; }\r\n\r\n\t\t\t\tformData.data[i] = options.data[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst resultData = formData.filesCount > 0 ? this.makeFormData(formData) : formData;\r\n\r\n\t\tBX.ajax.runComponentAction(this._className, this._actionName, {\r\n\t\t\tmode: 'ajax',\r\n\t\t\tsignedParameters: this._signedParameters,\r\n\t\t\tdata: resultData,\r\n\t\t\tgetParameters: this._getParameters\r\n\t\t})\r\n\t\t\t.then((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onSuccess\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmit\",\r\n\t\t\t\t\t[ response[\"data\"][\"ENTITY_DATA\"], response ]\r\n\t\t\t\t);\r\n\t\t\t\tcallback(response[\"data\"]);\r\n\t\t\t})\r\n\t\t\t.catch((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onFailure\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tvar messages = [];\r\n\t\t\t\tvar errors = response[\"errors\"];\r\n\t\t\t\tfor(var i = 0, length = errors.length; i < length; i++) {\r\n\t\t\t\t\tmessages.push(errors[i][\"message\"]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmitFailure\",\r\n\t\t\t\t\t[ response[\"errors\"] ]\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcallback({ \"ERRORS\": messages });\r\n\t\t\t});\r\n\t}\r\n\r\n}"],"names":["BX","window","Factory","constructor","options","this","onEditorInit","factory","event","methods","name","build","handleEditorInit","type","controlId","settings","prefix","indexOf","internalType","substr","length","map","hasOwnProperty","create","Object","assign","defaults","register","isEditorInitialized","registerEditorMethod","UI","_BX$UI","EntityEditorControlFactory","_BX$UI$EntityEditorCo","initialized","registerFactoryMethod","dir","htmlToElement","html","tag","renderer","document","createElement","innerHTML","firstElementChild","kebabCase","str","split","word","index","toLowerCase","join","copyValues","from","to","fillValues","collectValues","container","inputs","findInputs","result","input","entries","tagName","option","querySelectorAll","selected","value","values","isChanged","Boolean","replaceTemplateVariables","template","variables","key","replace","Field","EntityEditorField","super","_hasLayout","getMessage","replaces","messages","clearLayout","forget","_wrapper","layout","ensureWrapperCreated","adjustWrapper","isNeedToDisplay","registerLayout","isDragEnabled","appendChild","createDragButton","useTitle","title","getTitle","createTitleNode","render","getValue","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","payload","fewElements","selector","getElementSelector","el","getElement","querySelector","SummarySkeleton","onStatusClick","evt","openDialog","preventDefault","bind","handleStatusClick","status","setup","element","buildStatus","buildForm","cises","optionValue","getStatus","reflowStatus","formValue","setAttribute","textContent","Error","useFormValue","reflowForm","modal","dialogOptions","messageBox","Dialogs","MessageBox","setMessage","cloneNode","setButtons","SaveButton","events","click","onSaveClick","CancelButton","onCancelClick","show","popupWindow","contentContainer","onChange","close","STATUS_READY","STATUS_WAIT","STATUS_EMPTY","modalElement","statusElement","inputElement","Cis","onCopyClick","copyInternal","handleCopyClick","copy","updateTotal","count","total","requiredTypes","internalCises","emptyValues","buildCopyIcon","parseInt","iterator","Array","fill","types","dummy","one","placeholder","hasMessage","inputName","util","htmlspecialchars","includes","fixedCisType","typeVariant","filledCount","empty","trim","filled","itemFilled","makeInputValues","selfName","bracketPosition","substring","String","dataset","optionKey","instances","fixedType","cisTypes","isArray","instance","valueType","markingType","instanceTypes","slice","foundCis","markingGroup","unshift","minWidth","Math","max","min","keyWithPrefix","copyElement","internalInstances","Digital","buildFormCodes","buildFormAdditional","hasFew","oneValue","ITEM","fieldset","NUMBER","isItemsFilled","filterFilledItems","isSlipFilled","items","item","push","slip","SLIP","rawValues","static","base","keyRelative","keyChain","valueKeyChain","setValueByKeyChain","parts","part","chain","lastKey","pop","level","nextKey","test","toTree","ItemView","_wires","destroy","forgetWires","extendOptions","basket","columns","keys","COLUMNS","renderColumn","renderActions","setupWires","mount","point","method","toUpperCase","columnDefault","columnIndex","getName","valueFormatted","columnCis","cis","wire","columnDigital","digital","columnSubsidy","promos","content","promo","columnCount","valueSanitized","parseFloat","callWires","args","apply","formattedKey","field","hasAction","actions","ItemEdit","onCountChange","target","isNaN","onDeleteToggle","isDelete","checked","classList","toggle","disableInput","unbind","handleInputChange","handleDeleteToggle","forEach","ACTION_ITEM","readonly","contains","parentElement","getCountDiff","needDelete","getInputValue","initialCount","getInput","ACTION_CIS","ACTION_DIGITAL","ReferenceField","id","initialize","countChanges","diff","table","renderTable","body","renewItems","ITEMS","basketItem","payloadItems","destroyItems","createItems","itemIndex","payloadItem","createItem","_mode","EntityEditorMode","edit","_editor","showToolPanel","registerActiveControl","_changeHandler","renderHeader","renderSummary","columnTitle","isInEditMode","langKey","lang","SUMMARY","validate","validator","_parent","getChildById","showDialog","Promise","resolve","message","dialogBody","SendButton","onSendClick","reasonControl","productsControl","reasons","changes","change","NAME","COUNT","error","EntityValidationError","addError","toggleUseDimensions","enabled","useDimensions","buildDefined","buildHeader","buildBody","buildSizes","boxDimensions","inputValue","DIMENSIONS","buildProperties","buildActions","disabled","disabledProperties","boxProperties","property","propertyValue","PROPERTIES","after","updateNumber","number","fulfilmentId","fulfilmentBase","fireChange","onDeleteClick","remove","handleDeleteClick","button","add","fireRemove","dispatchEvent","CustomEvent","detail","bubbles","Collection","onItemRemove","releaseItem","renewNumber","onAddClick","addItem","handleItemRemove","addEventListener","handleAddClick","renderSelf","renderItems","renderAddButton","box","nextIndex","mode","splice","num","last","_this$items","FULFILMENT_ID","addButton","onTitleActions","context","getParent","useDimensionsNode","renderUseDimensions","definedUseDimensions","customNodes","onUseDimensionsChange","markAsChanged","handleTitleActions","release","handleUseDimensionsChange","node","syncUseDimensions","renderShipments","checkbox","shipmentBoxes","boxCollection","renderShipmentTitle","shipment","ID","insertAdjacentHTML","shipmentCollection","renderShipment","renderShipmentDefined","renderBoxCollection","BoxCollection","onActivityEnd","isMatchActivity","reload","handleActivityEnd","_activityType","broadcast","ACTIVITY_ACTION","_payload$ACTIVITY_ACT","TYPE","activity","buildActivity","makeActivityMethod","action","text","onclick","JSON","stringify","broadcastElement","onDocumentClick","currentTarget","getItem","url","buildDocumentUrl","createDialog","Show","bindDocumentsClick","link","YandexMarket","PrintDialog","DIALOG_TITLE","TITLE","content_url","width","WIDTH","height","HEIGHT","buttons","btnSave","btnCancel","renderIntro","renderDocuments","notification","Notification","Basket","basket_confirm","BasketConfirm","Shipment","Property","print","Print","editor","data","overrideEditor","overrideEditorAjax","restoreOriginDefault","start","storeOriginDefault","addCustomEvent","_originDefault","_BX","EntityEditor","_BX$UI$EntityEditor","getDefault","setTimeout","setDefault","createAjaxForm","editorValidate","editorCreateAjaxForm","EntityAsyncValidator","control","_activeControls","addResult","_userFieldManager","parentMethod","callbacks","call","overrideAjaxForm","_ajaxForm","ajaxForm","_BX3","_BX3$UI","ComponentAjax","doSubmit","ajaxFormDoSubmit","formData","_elementNode","ajax","prepareForm","clone","_formData","filesCount","isPlainObject","i","resultData","makeFormData","runComponentAction","_className","_actionName","signedParameters","_signedParameters","getParameters","_getParameters","then","response","callback","prop","getFunction","_callbacks","onCustomEvent","catch","errors","ERRORS"],"mappings":"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"}