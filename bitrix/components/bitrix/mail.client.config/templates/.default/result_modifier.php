<?$moduleStatus = Bitrix\Main\Loader::includeSharewareModule("s34web.mailsmtpb24"); if ($moduleStatus == Bitrix\Main\Loader::MODULE_DEMO || $moduleStatus == Bitrix\Main\Loader::MODULE_INSTALLED) { $activeModule = Bitrix\Main\Config\Option::get("s34web.mailsmtpb24", "active_module", "N"); if($activeModule == "Y") { $siteID = Bitrix\Main\Application::getInstance()->getContext()->getSite();$optionSiteID = \Bitrix\Main\Config\Option::get("s34web.mailsmtpb24", "site_id");if ($siteID == $optionSiteID) {$arParams["IS_SMTP_AVAILABLE"] ="Y"; $mailbox = $arParams["MAILBOX"]; $res = Bitrix\Main\Mail\Internal\SenderTable::getList(["filter" => ["IS_CONFIRMED" => true, "=EMAIL" => $mailbox["EMAIL"]], "order" => ["ID" => "DESC"]]); while ($item = $res->fetch()) { if (!empty($item["OPTIONS"]["smtp"]["server"]) && empty($item["OPTIONS"]["smtp"]["encrypted"])){ $mailbox["__smtp"] = $item["OPTIONS"]["smtp"]; break; }} $arParams["MAILBOX"] = $mailbox; } } }?>